(()=>{"use strict";class e{#e=0;#t;#s;#a;#n;constructor(e={}){this.#t=document.createElement("div"),this.#t.classList.add("progressbar-wrapper"),this.#s=document.createElement("div"),this.#s.setAttribute("role","progressbar"),this.#s.setAttribute("aria-label",e.l10n.uploadProgress),this.#s.classList.add("progressbar-background"),this.#t.appendChild(this.#s),this.#a=document.createElement("div"),this.#a.classList.add("progressbar-fill"),this.#s.appendChild(this.#a),this.#n=document.createElement("span"),this.#n.classList.add("progress-value"),this.#t.appendChild(this.#n),this.setProgress(0)}getDOM(){return this.#t}show(){this.#t.classList.remove("display-none")}hide(){this.#t.classList.add("display-none")}setProgress(e){"number"==typeof e&&(e=Math.max(0,Math.min(e,100)),this.#e=e,this.#t.setAttribute("aria-valuenow",this.#e),this.#a.style.width=`${this.#e}%`,this.#n.innerText=`${Math.floor(this.#e)}%`)}getProgress(){return this.#e}}class t{#i=!1;#r;#o;#d;#l;#c;#p;#h;#m;#u;constructor(e={},t={}){this.#r=e,this.#r.selectorDropzone&&(this.#o=t??{},this.#o.upload=this.#o.upload??(()=>{}),this.#o.reset=this.#o.reset??(()=>{}),this.#g())}#g(){if(this.#d=document.querySelector(this.#r.selectorDropzone),!this.#d)return;this.#d.innerHTML="",this.#d.addEventListener("click",(e=>{this.#f(e)})),this.#d.addEventListener("dragover",(e=>{this.#b(e)})),this.#d.addEventListener("dragleave",(()=>{this.#L()})),this.#d.addEventListener("drop",(e=>{this.#v(e)})),this.#l=document.createElement("div"),this.#l.classList.add("upload-wrapper"),this.#c=document.createElement("input"),this.#c.classList.add("file-input"),this.#c.id="file-input",this.#c.type="file",this.#c.accept=".h5p",this.#c.addEventListener("change",(e=>{this.#x(e)})),this.#l.append(this.#c);const t=document.createElement("label");t.classList.add("upload-button"),t.htmlFor="file-input",t.innerText=this.#r.l10n.uploadYourH5Pfile,this.#l.append(t),this.#d.append(this.#l),this.#p=document.createElement("div"),this.#p.classList.add("file-info"),this.#p.classList.add("display-none");const s=document.createElement("div");s.classList.add("file-data"),this.#p.append(s),this.#h=document.createElement("div"),this.#h.classList.add("file-name"),s.append(this.#h),this.#m=document.createElement("div"),this.#m.classList.add("file-value"),s.append(this.#m);const a=document.createElement("button");a.classList.add("remove-button"),a.setAttribute("aria-label",this.#r.l10n.removeFile),a.addEventListener("click",(()=>{this.reset()})),this.#p.append(a),this.#d.append(this.#p),this.#u=new e({l10n:{uploadProgress:this.#r.l10n.uploadProgress}}),this.hideProgress(),this.#d.append(this.#u.getDOM()),this.status=document.createElement("p"),this.status.classList.add("status"),this.status.innerText=this.#r.l10n.orDragTheFileHere,this.#d.append(this.status)}#E(e={}){e.name&&(this.#y(),this.#h.innerText=e.name,e.size&&(this.#m.innerText=`${(e.size/1024).toFixed(2)} KB`),this.#l.classList.add("display-none"),this.#p.classList.remove("display-none"))}#T(){this.#i=!1,this.#d.removeAttribute("disabled")}#y(){this.#i=!0,this.#d.setAttribute("disabled","disabled")}reset(){this.#p.classList.add("display-none"),this.#l.classList.remove("display-none"),this.setStatus(this.#r.l10n.orDragTheFileHere),this.#T(),this.#o.reset()}setStatus(e="",t=""){this.status.classList.toggle("display-none",!e),this.status.classList.toggle("error","error"===t),this.status.classList.toggle("pulse","pulse"===t),this.status.innerText=e}showProgress(){this.#u.show()}hideProgress(){this.#u.hide()}setProgress(e){this.#u.setProgress(e)}#f(e){this.#i||e.target===this.#d&&(this.#c.click(),this.#d.classList.add("active"))}#b(e){e?.preventDefault(),this.#d.classList.add("dragging")}#L(){this.#d.classList.remove("dragging")}#v(e){e.preventDefault(),e?.dataTransfer.files.length&&(this.#d.classList.remove("dragging"),this.#c.files=e.dataTransfer.files,this.#z(this.#c.files[0]))}#x(e){this.#z(e.target.files[0])}#z(e){e&&(this.#E(e),this.#c.value="",this.#d.classList.remove("active"),this.#o.upload(e))}}const s=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(e=>{const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}));class a{#t;constructor(e={}){if(this.#t=document.createElement("div"),this.#t.classList.add("message-content"),e.message.category){const t=document.createElement("div");t.classList.add("message-content-item");const s=document.createElement("p");s.classList.add("message-content-item-label"),s.innerText=e.translations.category,t.append(s);const a=document.createElement("p");a.classList.add("message-content-item-text");let n=e.translations[e.message.category];e.message.type&&(n=`${n} > ${e.translations[e.message.type]}`),a.innerText=n,t.append(a),this.#t.append(t)}if(e.message.recommendation){const t=document.createElement("div");t.classList.add("message-content-item");const s=document.createElement("p");s.classList.add("message-content-item-label"),s.innerText=e.translations.recommendation,t.append(s);const a=document.createElement("p");a.classList.add("message-content-item-text"),a.innerText=e.message.recommendation,t.append(a),this.#t.append(t)}if("libreText"===e.message.type){const t=`<h3>Status</h3><p>${e.message.details.status}</p>`;e.message.details.description=`${e.message.details.description}${t}`;this.#D(e.message.details.description).forEach((e=>{const t=document.createElement("div");t.classList.add("message-content-item");const s=document.createElement("p");s.classList.add("message-content-item-label"),s.innerText=e.headline,t.append(s);const a=document.createElement("div");a.classList.add("message-content-details"),a.innerHTML=e.html,t.append(a),this.#t.append(t)}))}else if(e.message.details){const t=document.createElement("div");t.classList.add("message-content-item");const s=document.createElement("p");s.classList.add("message-content-item-label"),s.innerText=e.translations.details,t.append(s);const a=document.createElement("ul");a.classList.add("message-content-details"),Object.keys(e.message.details).forEach((t=>{if("reference"===t||"base64"===t)return;const s=document.createElement("li");s.classList.add("message-content-detail"),s.innerText=`${t}: ${e.message.details[t]}`,a.append(s)})),t.append(a),this.#t.append(t)}if(e.message.details?.base64){const t=document.createElement("div");t.classList.add("message-content-item");const s=document.createElement("p");s.classList.add("message-content-item-label"),s.innerText=e.translations.image,t.append(s);const a=document.createElement("img");a.classList.add("message-content-image"),a.src=e.message.details.base64,t.append(a),this.#t.append(t)}if(e.message.details?.reference){const t=document.createElement("a");t.classList.add("message-content-reference"),t.href=e.message.details.reference,t.target="_blank",t.innerText=e.translations.learnMore,this.#t.append(t)}}getDOM(){return this.#t}#D(e){const t=(new DOMParser).parseFromString(e,"text/html").querySelectorAll("h2, h3, h4, h5, h6"),s=[];return t.forEach(((e,t)=>{const a=e.textContent.trim();let n="",i=e.nextElementSibling;for(;i&&!i.matches("h2, h3, h4, h5, h6");)n+=i.outerHTML,i=i.nextElementSibling;s.push({headline:a,html:n.trim()})})),s}}class n{#t;constructor(e={}){this.#t=document.createElement("div"),this.#t.classList.add("message-accordion-panel");const t=s(),n=s(),i=document.createElement("div");i.classList.add("message-accordion-panel-header"),i.setAttribute("Id",t);const r=document.createElement("span");r.classList.add("message-accordion-panel-icon"),i.append(r);const o=document.createElement("button");if(o.classList.add("message-accordion-panel-button"),o.setAttribute("aria-expanded","false"),o.setAttribute("aria-controls",n),o.innerText=e.message.summary,i.append(o),e.message.level&&e.translations[e.message.level]){const t=document.createElement("span");t.classList.add("message-accordion-panel-level"),t.classList.add(e.message.level),t.innerText=e.translations[e.message.level],i.append(t)}this.#t.append(i);const d=document.createElement("div");d.setAttribute("Id",n),d.classList.add("message-accordion-panel-content-grid"),d.setAttribute("role","region"),d.setAttribute("aria-labelledby",t),d.setAttribute("aria-hidden","true");const l=document.createElement("div");l.classList.add("message-accordion-panel-content-wrapper");const c=new a({message:e.message,translations:e.translations});l.append(c.getDOM()),d.append(l),this.#t.append(d),this.#t.addEventListener("click",(()=>{const e="true"===o.getAttribute("aria-expanded");d.setAttribute("aria-hidden",e.toString()),o.setAttribute("aria-expanded",(!e).toString())}))}getDOM(){return this.#t}}class i{#t;constructor(e={}){this.#t=document.createElement("div"),this.#t.classList.add("message-accordion");const t=document.createElement("div");t.classList.add("message-accordion-header"),t.innerText=e.translations[`${e.type}s`],this.#t.append(t);const s=document.createElement("ul");s.classList.add("message-accordion-panels-list"),this.#t.append(s),e.messages.forEach((t=>{const a=document.createElement("li");a.classList.add("message-accordion-panels-list-item");const i=new n({message:t,translations:e.translations});a.append(i.getDOM()),s.append(a)}))}getDOM(){return this.#t}}const r={orDragTheFileHere:"or drag the file here",removeFile:"Remove file",selectYourLanguage:"Select your language",uploadProgress:"Upload progress",uploadYourH5Pfile:"Upload your H5P file",yourFileIsBeingChecked:"Your file is being checked",yourFileWasCheckedSuccessfully:"Your file was checked successfully"},o=200,d=300;new class{#d;#k;#w;constructor(){this.#w={...r,...window.H5P_CARETAKER_L10N};const e=document.querySelector("main");this.#k=e?.dataset.uploadEndpoint??"./upload",document.addEventListener("DOMContentLoaded",(()=>{this.#P()}))}#P(){const e=document.querySelector(".h5p-caretaker .select-language");e?.setAttribute("aria-label",r.selectYourLanguage),e?.addEventListener("change",(e=>{this.#S(e)})),this.#d=new t({selectorDropzone:".h5p-caretaker .dropzone",l10n:{orDragTheFileHere:this.#w.orDragTheFileHere,removeFile:this.#w.removeFile,uploadProgress:this.#w.uploadProgress,uploadYourH5Pfile:this.#w.uploadYourH5Pfile}},{upload:async e=>{this.#z(e)},reset:()=>{this.#I()}})}#z(e){const t=new FormData;t.append("file",e),t.set("locale",document.querySelector(".select-language")?.value??"en"),this.#d.setStatus(""),this.#d.showProgress();const s=new XMLHttpRequest;s.open("POST",this.#k,!0),s.upload.addEventListener("progress",(e=>{e.lengthComputable&&this.#M(e.loaded/e.total*100)})),s.addEventListener("load",(()=>{this.#F(s)})),s.addEventListener("error",(()=>{this.#A(s.statusText)})),s.send(t)}#I(){document.querySelector(".output").innerHTML=""}#S(e){const t=new URLSearchParams(window.location.search);t.set(e.target.dataset.localeKey??"locale",e.target.value),window.location.href=`${window.location.pathname}?${t.toString()}${window.location.hash}`}#M(e){this.#d.setProgress(e),100===e&&(this.#d.hideProgress(),this.#d.setStatus(this.#w.yourFileIsBeingChecked,"pulse"))}#F(e){if(this.#d.hideProgress(),e.status>=o&&e.status<d){const t=JSON.parse(e.responseText);this.#d.setStatus(this.#w.yourFileWasCheckedSuccessfully),["error","warning","info"].forEach((e=>{const s=t.messages.filter((t=>t.level===e)).map((e=>{const s=e.details?.path;return s&&s.startsWith("images/")?(e.details?.path&&e.details?.path.startsWith("images/")&&(e.details.base64=t.raw.media.images[s.split("/").pop()].base64),e):e}));if(s.length){const a=new i({type:e,messages:s,translations:t.client.translations});document.querySelector(".output").append(a.getDOM())}}))}else this.#A(e.responseText)}#A(e){this.#d.setStatus(e,"error")}}})();