(()=>{"use strict";const e=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(e=>{const s=16*Math.random()|0;return("x"===e?s:3&s|8).toString(16)})),s=e=>"string"!=typeof e?"":`${e[0].toUpperCase()}${e.slice(1)}`;class t{#e=0;#s;#t;#a;#n;constructor(e={}){this.#s=document.createElement("div"),this.#s.classList.add("progressbar-wrapper"),this.#t=document.createElement("div"),this.#t.setAttribute("role","progressbar"),this.#t.setAttribute("aria-label",e.l10n.uploadProgress),this.#t.classList.add("progressbar-background"),this.#s.appendChild(this.#t),this.#a=document.createElement("div"),this.#a.classList.add("progressbar-fill"),this.#t.appendChild(this.#a),this.#n=document.createElement("span"),this.#n.classList.add("progress-value"),this.#s.appendChild(this.#n),this.setProgress(0)}getDOM(){return this.#s}show(){this.#s.classList.remove("display-none")}hide(){this.#s.classList.add("display-none")}setProgress(e){"number"==typeof e&&(e=Math.max(0,Math.min(e,100)),this.#e=e,this.#s.setAttribute("aria-valuenow",this.#e),this.#a.style.width=`${this.#e}%`,this.#n.innerText=`${Math.floor(this.#e)}%`)}getProgress(){return this.#e}}class a{#i=!1;#l;#o;#r;#d;#c;#p;#h;#m;#u;constructor(e={},s={}){this.#l=e,this.#l.selectorDropzone&&(this.#o=s??{},this.#o.upload=this.#o.upload??(()=>{}),this.#o.reset=this.#o.reset??(()=>{}),this.#g())}#g(){if(this.#r=document.querySelector(this.#l.selectorDropzone),!this.#r)return;this.#r.innerHTML="",this.#r.addEventListener("click",(e=>{this.#b(e)})),this.#r.addEventListener("dragover",(e=>{this.#x(e)})),this.#r.addEventListener("dragleave",(()=>{this.#f()})),this.#r.addEventListener("drop",(e=>{this.#v(e)})),this.#d=document.createElement("div"),this.#d.classList.add("upload-wrapper"),this.#c=document.createElement("input"),this.#c.classList.add("file-input"),this.#c.id="file-input",this.#c.type="file",this.#c.accept=".h5p",this.#c.addEventListener("change",(e=>{this.#L(e)})),this.#d.append(this.#c);const e=document.createElement("label");e.classList.add("upload-button"),e.htmlFor="file-input",e.innerText=this.#l.l10n.uploadYourH5Pfile,this.#d.append(e),this.#r.append(this.#d),this.#p=document.createElement("div"),this.#p.classList.add("file-info"),this.#p.classList.add("display-none");const s=document.createElement("div");s.classList.add("file-data"),this.#p.append(s),this.#h=document.createElement("div"),this.#h.classList.add("file-name"),s.append(this.#h),this.#m=document.createElement("div"),this.#m.classList.add("file-value"),s.append(this.#m);const a=document.createElement("button");a.classList.add("remove-button"),a.setAttribute("aria-label",this.#l.l10n.removeFile),a.addEventListener("click",(()=>{this.reset()})),this.#p.append(a),this.#r.append(this.#p),this.#u=new t({l10n:{uploadProgress:this.#l.l10n.uploadProgress}}),this.hideProgress(),this.#r.append(this.#u.getDOM()),this.status=document.createElement("p"),this.status.classList.add("status"),this.status.innerText=this.#l.l10n.orDragTheFileHere,this.#r.append(this.status)}#y(e={}){e.name&&(this.#E(),this.#h.innerText=e.name,e.size&&(this.#m.innerText=`${(e.size/1024).toFixed(2)} KB`),this.#d.classList.add("display-none"),this.#p.classList.remove("display-none"))}#w(){this.#i=!1,this.#r.removeAttribute("disabled")}#E(){this.#i=!0,this.#r.setAttribute("disabled","disabled")}reset(){this.#p.classList.add("display-none"),this.#d.classList.remove("display-none"),this.setStatus(this.#l.l10n.orDragTheFileHere),this.#w(),this.#o.reset()}setStatus(e="",s=""){this.status.classList.toggle("display-none",!e),this.status.classList.toggle("error","error"===s),this.status.classList.toggle("pulse","pulse"===s),this.status.innerText=e}showProgress(){this.#u.show()}hideProgress(){this.#u.hide()}setProgress(e){this.#u.setProgress(e)}#b(e){this.#i||e.target===this.#r&&(this.#c.click(),this.#r.classList.add("active"))}#x(e){e?.preventDefault(),this.#r.classList.add("dragging")}#f(){this.#r.classList.remove("dragging")}#v(e){e.preventDefault(),e?.dataTransfer.files.length&&(this.#r.classList.remove("dragging"),this.#c.files=e.dataTransfer.files,this.#M(this.#c.files[0]))}#L(e){this.#M(e.target.files[0])}#M(e){e&&(this.#y(e),this.#c.value="",this.#r.classList.remove("active"),this.#o.upload(e))}}const n=100,i={5:"good",10:"neutral",100:"bad"};class l{#s;#k;#T;#l;constructor(e={}){this.#l=e,"number"==typeof e.size&&(e.size=`${e.size}px`),this.#l.size=e.size??"5rem",this.#l.strokeWidth=e.strokeWidth??"0.5rem",this.#l.max=e.max??n,this.#s=document.createElement("div"),this.#s.classList.add("progress-circle-wrapper"),this.#s.style.setProperty("--size",this.#l.size),this.#s.style.setProperty("--stroke-width",this.#l.strokeWidth);const s=document.createElementNS("http://www.w3.org/2000/svg","svg");s.classList.add("progress-circle"),s.setAttribute("width","100%"),s.setAttribute("height","100%"),this.#s.append(s);const t=document.createElementNS("http://www.w3.org/2000/svg","circle");t.setAttribute("class","progress-circle-background"),s.append(t);const a=document.createElementNS("http://www.w3.org/2000/svg","circle");a.setAttribute("class","progress-circle-foreground"),s.append(a),this.setColor(this.#l.color),this.#k=document.createElement("span"),this.#k.classList.add("progress-circle-value"),this.setValue(this.#l.value,this.#l.max,this.#l.percentage),this.#s.append(this.#k),this.#T=document.createElement("span"),this.#T.classList.add("progress-circle-label"),this.setLabel(this.#l.label,this.#l.link),this.#s.append(this.#T)}getDOM(){return this.#s}setValue(e,s=100,t=!0){"number"==typeof e&&(("number"!=typeof s||s<0)&&(s=n),"boolean"!=typeof t&&(t=!0),e=Math.max(0,Math.min(s,e)),t&&(e=e/s*n),e=Math.round(e),this.#l.value=e,t?this.#s.style.setProperty("--progress",e):this.#s.style.setProperty("--progress",e/s*n),this.#s.classList.toggle("empty",0===e),this.#k.innerText=t?`${e}%`:`${e}`,0===e?this.setColor("transparent"):this.setColor(this.#l.color))}setLabel(e,s){"string"==typeof e&&("string"!=typeof s?this.#T.innerText=e:this.#T.innerHTML=`<a href="${s}">${e}</a>`)}setColor(e){if("string"==typeof e&&(this.#s.style.setProperty("--stroke-color",e),"transparent"!==e&&"status"!==e&&(this.#l.color=e),"status"===e)){const e=this.#l.value/this.#l.max*n;for(const s in i)if(e<=s){this.#s.style.setProperty("--stroke-color",`var(--color-status-${i[s]})`);break}}}}class o{#s;#A;#l;#o;#S;constructor(e={},s={}){this.#l=e,this.#o=s,this.#o.onResultsTypeChanged=this.#o.onResultsTypeChanged??(()=>{}),this.#S=this.#C(this.#l.results),this.#s=document.createElement("div"),this.#s.classList.add("results");const t=document.createElement("div");t.classList.add("results-header"),t.textContent="Results",this.#s.append(t),this.#A=document.createElement("div"),this.#A.classList.add("results-box"),this.#s.append(this.#A),this.#A.append(this.#S[Object.keys(this.#l.results)[0]]),this.#A.append(this.#z())}getDOM(){return this.#s}#C(e){const s={};for(const t in e)s[t]=this.#D(e[t]);return s}#D(e={}){const s=document.createElement("div");s.classList.add("results-row");const t=document.createElement("div");t.classList.add("overview"),s.append(t);const a=document.createElement("div");a.classList.add("overview-header"),a.textContent=e.header,t.append(a);const n=document.createElement("div");n.classList.add("overview-value"),n.textContent=e.value,t.append(n);const i=document.createElement("div");return i.classList.add("progress-circles"),s.append(i),e.items.forEach((e=>{const s=new l({value:e.value,max:e.max,percentage:e.percentage,label:e.label,link:e.link,color:e.color});i.append(s.getDOM())})),s}#z(){const e=document.createElement("div");e.classList.add("navigation-row");const t=document.createElement("select");t.classList.add("select-results-type"),t.addEventListener("change",(e=>{this.#$(e)})),e.append(t);for(const e in this.#l.results){const a=document.createElement("option");a.value=e;const n=this.#l.results[e].type,i=s(this.#l.results[e].label??e);a.textContent="filter"===n?`${this.#l.l10n.filterBy}: ${i}`:"group"===n?`${this.#l.l10n.groupBy}: ${i}`:i,t.append(a)}const a=document.createElement("button");return a.classList.add("button-download"),a.textContent=this.#l.l10n.download,e.append(a),e}#$(e){this.#A.querySelector(".results-row").remove(),this.#A.prepend(this.#S[e.target.value]),this.#o.onResultsTypeChanged(e.target.value)}}class r{#l;#s;#o;#P=!1;#B=!1;constructor(e={},s={}){this.#l=e,this.#l.l10n=this.#l.l10n??{},this.#l.l10n.expandAllMessages=this.#l.l10n.expandAllMessages??"Expand all messages",this.#l.l10n.collapseAllMessages=this.#l.l10n.collapseAllMessages??"Collapse all messages",this.#o=s,this.#o.expandedStateChanged=this.#o.expandedStateChanged??(()=>{}),this.#s=document.createElement("button"),this.#s.classList.add("expand-button"),this.#s.addEventListener("click",(()=>{this.toggle()})),this.#O()}getDOM(){return this.#s}toggle(e,s=!1){("boolean"==typeof e?e:!this.#P)?this.#R(s):this.#O(s)}#O(e=!1){this.#s.innerHTML=this.#l.l10n.expandAllMessages,this.#s.classList.remove("expanded"),this.#P=!1,e||this.#o.expandedStateChanged(this.#P)}#R(e=!1){this.#s.innerHTML=this.#l.l10n.collapseAllMessages,this.#s.classList.add("expanded"),this.#P=!0,e||this.#o.expandedStateChanged(this.#P)}setWidth=()=>{if(this.#B)return;const e=document.createElement("div");e.classList.add("offsite");const s=document.createElement("button");s.classList.add("expand-button"),s.innerHTML=this.#l.l10n.expandAllMessages,e.append(s);const t=document.createElement("button");t.classList.add("expand-button"),t.classList.add("expanded"),t.innerHTML=this.#l.l10n.collapseAllMessages,e.append(t),document.body.append(e),document.fonts.ready.then((()=>{const a=s.getBoundingClientRect().width,n=t.getBoundingClientRect().width;this.fixedButtonWidth=Math.ceil(Math.max(a,n)),this.#s.style.width=`${this.fixedButtonWidth}px`,this.#B=!0,e?.remove()}))}}class d{#s;constructor(e={}){if(this.#s=document.createElement("div"),this.#s.classList.add("message-content"),e.message.category){const s=document.createElement("div");s.classList.add("message-content-item");const t=document.createElement("p");t.classList.add("message-content-item-label"),t.innerText=e.translations.category,s.append(t);const a=document.createElement("p");a.classList.add("message-content-item-text");let n=e.translations[e.message.category];e.message.type&&(n=`${n} > ${e.translations[e.message.type]}`),a.innerText=n,s.append(a),this.#s.append(s)}if(e.message.recommendation){const s=document.createElement("div");s.classList.add("message-content-item");const t=document.createElement("p");t.classList.add("message-content-item-label"),t.innerText=e.translations.recommendation,s.append(t);const a=document.createElement("p");a.classList.add("message-content-item-text"),a.innerText=e.message.recommendation,s.append(a),this.#s.append(s)}if("libreText"===e.message.type){const s=`<h3>${e.translations.status}</h3><p>${e.message.details.status}</p>`;e.message.details.description=`${e.message.details.description}${s}`;const t=`<h3>${e.translations.licenseNote}</h3><p>${e.message.details.licenseNote}</p>`;e.message.details.description=`${e.message.details.description}${t}`;this.#I(e.message.details.description).forEach((e=>{const s=document.createElement("div");s.classList.add("message-content-item");const t=document.createElement("p");t.classList.add("message-content-item-label"),t.innerText=e.headline,s.append(t);const a=document.createElement("div");a.classList.add("message-content-details"),a.innerHTML=e.html,s.append(a),this.#s.append(s)}))}else if(e.message.details){const s=document.createElement("div");s.classList.add("message-content-item");const t=document.createElement("p");t.classList.add("message-content-item-label"),t.innerText=e.translations.details,s.append(t);const a=document.createElement("ul");a.classList.add("message-content-details"),Object.keys(e.message.details).forEach((s=>{if("reference"===s||"base64"===s)return;const t=document.createElement("li");t.classList.add("message-content-detail"),t.innerText=`${s}: ${e.message.details[s]}`,a.append(t)})),s.append(a),this.#s.append(s)}if(e.message.details?.base64){const s=document.createElement("div");s.classList.add("message-content-item");const t=document.createElement("p");t.classList.add("message-content-item-label"),t.innerText=e.translations.image,s.append(t);const a=document.createElement("img");a.classList.add("message-content-image"),a.src=e.message.details.base64,s.append(a),this.#s.append(s)}if(e.message.details?.reference){const s=document.createElement("a");s.classList.add("message-content-reference"),s.href=e.message.details.reference,s.target="_blank",s.innerText=e.translations.learnMore,this.#s.append(s)}}getDOM(){return this.#s}#I(e){const s=(new DOMParser).parseFromString(e,"text/html").querySelectorAll("h2, h3, h4, h5, h6"),t=[];return s.forEach(((e,s)=>{const a=e.textContent.trim();let n="",i=e.nextElementSibling;for(;i&&!i.matches("h2, h3, h4, h5, h6");)n+=i.outerHTML,i=i.nextElementSibling;t.push({headline:a,html:n.trim()})})),t}}class c{#s;#F;#W;#o;constructor(s={},t={}){this.#o=t,this.#o.expandedStateChanged=this.#o.expandedStateChanged??(()=>{}),this.#s=document.createElement("div"),this.#s.classList.add("message-accordion-panel");const a=e(),n=e(),i=document.createElement("div");i.classList.add("message-accordion-panel-header"),i.setAttribute("Id",a);const l=document.createElement("span");if(l.classList.add("message-accordion-panel-icon"),i.append(l),this.#W=document.createElement("button"),this.#W.classList.add("message-accordion-panel-button"),this.#W.setAttribute("aria-expanded","false"),this.#W.setAttribute("aria-controls",n),this.#W.innerText=s.message.summary,i.append(this.#W),s.message.level&&s.translations[s.message.level]){const e=document.createElement("span");e.classList.add("message-accordion-panel-level"),e.classList.add(s.message.level),e.innerText=s.translations[s.message.level],i.append(e)}this.#s.append(i),this.#F=document.createElement("div"),this.#F.setAttribute("Id",n),this.#F.classList.add("message-accordion-panel-content-grid"),this.#F.setAttribute("role","region"),this.#F.setAttribute("aria-labelledby",a),this.#F.setAttribute("hidden","");const o=document.createElement("div");o.classList.add("message-accordion-panel-content-wrapper");const r=new d({message:s.message,translations:s.translations});o.append(r.getDOM()),this.#F.append(o),this.#s.append(this.#F),this.#s.addEventListener("click",(()=>{this.toggle()}))}getDOM(){return this.#s}isExpanded(){return"true"===this.#W.getAttribute("aria-expanded")}toggle(e){("boolean"==typeof e?e:"true"!==this.#W.getAttribute("aria-expanded"))?this.expand():this.collapse()}expand(){this.#F.removeAttribute("hidden"),this.#W.setAttribute("aria-expanded","true"),this.#o.expandedStateChanged(!0)}collapse(){this.#F.setAttribute("hidden",""),this.#W.setAttribute("aria-expanded","false"),this.#o.expandedStateChanged(!1)}}class p{#s;constructor(e={}){this.#s=document.createElement("div"),this.#s.classList.add("message-accordion");const s=[],t=document.createElement("a");t.classList.add("message-accordion-header-anchor"),t.setAttribute("name",`${e.type}`),this.#s.append(t);const a=document.createElement("div");a.classList.add("message-accordion-header"),this.#s.append(a);const n=document.createElement("p");n.classList.add("message-accordion-header-text"),n.innerText=e.header,a.append(n);const i=new r({l10n:{expandAllMessages:e.l10n.expandAllMessages,collapseAllMessages:e.l10n.collapseAllMessages}},{expandedStateChanged:e=>{s.forEach((s=>{s.toggle(e)}))}});i.setWidth(),a.append(i.getDOM());const l=document.createElement("ul");l.classList.add("message-accordion-panels-list"),this.#s.append(l),e.messages.forEach((t=>{const a=document.createElement("li");a.classList.add("message-accordion-panels-list-item");const n=new c({message:t,translations:e.translations},{expandedStateChanged:e=>{s.every((e=>!e.isExpanded()))?i.toggle(!1,!0):i.toggle(!0,!0)}});a.append(n.getDOM()),s.push(n),l.append(a)}))}getDOM(){return this.#s}}class h{#s;constructor(e={}){this.#s=document.createElement("div"),this.#s.classList.add("message-set"),e.sections.forEach((s=>{const t=e.messages.filter((t=>t[e.id]===s.id));if(!t.length)return;const a=new p({type:s.id,header:s.header,messages:t,translations:e.translations,l10n:{expandAllMessages:e.l10n.expandAllMessages,collapseAllMessages:e.l10n.collapseAllMessages}});this.#s.append(a.getDOM())}))}getDOM(){return this.#s}show(){this.#s.classList.remove("display-none")}hide(){this.#s.classList.add("display-none")}}class m{#s;#H;constructor(e={}){this.#s=document.createElement("div"),this.#s.classList.add("message-sets"),this.#H={};for(const s in e.sets)e.sets[s]=e.sets[s].filter((e=>"string"==typeof e||"string"==typeof e?.id)).map((s=>("string"==typeof s&&(s={id:s}),s.header=s.header??e.translations[s.id],s))),e.sets[s].length||delete e.sets[s];if(0!==Object.keys(e.sets).length){for(const s in e.sets)this.#H[s]=new h({id:s,sections:e.sets[s],messages:e.messages,translations:e.translations,l10n:{expandAllMessages:e.l10n.expandAllMessages,collapseAllMessages:e.l10n.collapseAllMessages}}),this.#s.append(this.#H[s].getDOM());this.show(Object.keys(this.#H)[0])}}getDOM(){return this.#s}show(e){if(this.#H[e])for(const s in this.#H)s===e?this.#H[s].show():this.#H[s].hide()}}const u={orDragTheFileHere:"or drag the file here",removeFile:"Remove file",selectYourLanguage:"Select your language",uploadProgress:"Upload progress",uploadYourH5Pfile:"Upload your H5P file",yourFileIsBeingChecked:"Your file is being checked",yourFileWasCheckedSuccessfully:"Your file was checked successfully",totalMessages:"Total messages",issues:"issues",filterBy:"Filter by",groupBy:"Group by",download:"Download",expandAllMessages:"Expand all messages",collapseAllMessages:"Collapse all messages"},g=200,b=300;new class{#r;#N;#U;constructor(){this.#U={...u,...window.H5P_CARETAKER_L10N};const e=document.querySelector("main");this.#N=e?.dataset.uploadEndpoint??"./upload",document.addEventListener("DOMContentLoaded",(()=>{this.#G()}))}#G(){const e=document.querySelector(".h5p-caretaker .select-language");e?.setAttribute("aria-label",u.selectYourLanguage),e?.addEventListener("change",(e=>{this.#q(e)})),this.#r=new a({selectorDropzone:".h5p-caretaker .dropzone",l10n:{orDragTheFileHere:this.#U.orDragTheFileHere,removeFile:this.#U.removeFile,uploadProgress:this.#U.uploadProgress,uploadYourH5Pfile:this.#U.uploadYourH5Pfile}},{upload:async e=>{this.#M(e)},reset:()=>{this.#Y()}})}#M(e){const s=new FormData;s.append("file",e),s.set("locale",document.querySelector(".select-language")?.value??"en"),this.#r.setStatus(""),this.#r.showProgress();const t=new XMLHttpRequest;t.open("POST",this.#N,!0),t.upload.addEventListener("progress",(e=>{e.lengthComputable&&this.#V(e.loaded/e.total*100)})),t.addEventListener("load",(()=>{this.#j(t)})),t.addEventListener("error",(()=>{this.#K(t.statusText)})),t.send(s)}#Y(){document.querySelector(".output").innerHTML=""}#q(e){const s=new URLSearchParams(window.location.search);s.set(e.target.dataset.localeKey??"locale",e.target.value),window.location.href=`${window.location.pathname}?${s.toString()}${window.location.hash}`}#V(e){this.#r.setProgress(e),100===e&&(this.#r.hideProgress(),this.#r.setStatus(this.#U.yourFileIsBeingChecked,"pulse"))}#j(e){if(this.#r.hideProgress(),e.status>=g&&e.status<b){const t=JSON.parse(e.responseText);this.#U={...this.#U,...t.client.translations},this.#r.setStatus(this.#U.yourFileWasCheckedSuccessfully),t.messages=t.messages.map((e=>{e.issues=("error"===e.level||"warning"===e.level)&&"issues";const s=e.details?.path;return s&&s.startsWith("images/")?(e.details?.path&&e.details?.path.startsWith("images/")&&(e.details.base64=t.raw.media.images[s.split("/").pop()].base64),e):e}));const a=[{value:t.messages.filter((e=>"error"===e.level)).length,max:t.messages.length,label:s(this.#U.errors),link:`#${this.#U.error}`,color:"var(--color-error)",percentage:!1},{value:t.messages.filter((e=>"warning"===e.level)).length,max:t.messages.length,label:s(this.#U.warnings),link:`#${this.#U.warning}`,color:"var(--color-warning)",percentage:!1},{value:t.messages.filter((e=>"info"===e.level)).length,max:t.messages.length,label:s(this.#U.infos),link:`#${this.#U.info}`,color:"var(--color-info)",percentage:!1}],n=[...new Set(t.messages.map((e=>e.category)))],i=n.map((e=>({value:t.messages.filter((s=>s.category===e)).length,max:t.messages.length,label:s(this.#U[e]),link:`#${e}`,color:"var(--color-primary)",percentage:!1}))),l=[{value:t.messages.filter((e=>e.issues)).length,max:t.messages.length,label:s(this.#U.issues),link:`#${this.#U.issues}`,color:"status",percentage:!1}],r={issues:{label:this.#U.issues,header:this.#U.totalMessages,value:t.messages.length,items:l,type:"filter"},level:{label:this.#U.level,header:this.#U.totalMessages,value:t.messages.length,items:a,type:"group"},category:{label:this.#U.category,header:this.#U.totalMessages,value:t.messages.length,items:i,type:"group"}},d=new o({results:r,l10n:{filterBy:this.#U.filterBy,groupBy:this.#U.groupBy,download:this.#U.download}},{onResultsTypeChanged:e=>{c.show(e)}});document.querySelector(".output").append(d.getDOM());const c=new m({sets:{issues:[{id:"issues",header:this.#U.issues}],level:["error","warning","info"],category:n},messages:t.messages,translations:t.client.translations,l10n:{expandAllMessages:this.#U.expandAllMessages,collapseAllMessages:this.#U.collapseAllMessages}});document.querySelector(".output").append(c.getDOM())}else this.#K(e.responseText)}#K(e){this.#r.setStatus(e,"error")}}})();