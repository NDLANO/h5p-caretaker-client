(()=>{"use strict";const e=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(e=>{const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})),t=e=>"string"!=typeof e?"":`${e[0].toUpperCase()}${e.slice(1)}`;class s{#e=0;#t;#s;#i;#a;constructor(e={}){this.#t=document.createElement("div"),this.#t.classList.add("progressbar-wrapper"),this.#s=document.createElement("div"),this.#s.setAttribute("role","progressbar"),this.#s.setAttribute("aria-label",e.l10n.uploadProgress),this.#s.classList.add("progressbar-background"),this.#t.appendChild(this.#s),this.#i=document.createElement("div"),this.#i.classList.add("progressbar-fill"),this.#s.appendChild(this.#i),this.#a=document.createElement("span"),this.#a.classList.add("progress-value"),this.#t.appendChild(this.#a),this.setProgress(0)}getDOM(){return this.#t}show(){this.#t.classList.remove("display-none")}hide(){this.#t.classList.add("display-none")}setProgress(e){"number"==typeof e&&(e=Math.max(0,Math.min(e,100)),this.#e=e,this.#t.setAttribute("aria-valuenow",this.#e),this.#i.style.width=`${this.#e}%`,this.#a.innerText=`${Math.floor(this.#e)}%`)}getProgress(){return this.#e}}class i{#n=!1;#l=null;#o;#r;#d;#c;#h;#u;#p;#m;#g;#b;constructor(e={},t={}){this.#o=e,this.#o.selectorDropzone&&(this.#r=t??{},this.#r.upload=this.#r.upload??(()=>{}),this.#r.reset=this.#r.reset??(()=>{}),this.#f())}#f(){if(this.#d=document.querySelector(this.#o.selectorDropzone),!this.#d)return;if(this.#d.innerHTML="",this.#d.addEventListener("click",(e=>{this.#v(e)})),this.#d.addEventListener("dragover",(e=>{this.#y(e)})),this.#d.addEventListener("dragleave",(()=>{this.#E()})),this.#d.addEventListener("drop",(e=>{this.#x(e)})),this.#h=document.createElement("div"),this.#h.classList.add("upload-wrapper"),this.#o.sessionKeyName&&this.#o.sessionKeyValue){const e=document.createElement("input");e.type="hidden",e.name=this.#o.sessionKeyName,e.value=this.#o.sessionKeyValue,this.#h.append(e)}this.#u=document.createElement("input"),this.#u.classList.add("file-input"),this.#u.id="file-input",this.#u.type="file",this.#u.accept=".h5p",this.#u.addEventListener("change",(e=>{this.#L(e)})),this.#h.append(this.#u);const e=document.createElement("label");e.classList.add("upload-button"),e.htmlFor="file-input",e.innerText=this.#o.l10n.uploadYourH5Pfile,this.#h.append(e),this.#d.append(this.#h),this.#p=document.createElement("div"),this.#p.classList.add("file-info"),this.#p.classList.add("display-none");const t=document.createElement("div");t.classList.add("file-data"),this.#p.append(t),this.#m=document.createElement("div"),this.#m.classList.add("file-name"),t.append(this.#m),this.#g=document.createElement("div"),this.#g.classList.add("file-value"),t.append(this.#g);const i=document.createElement("button");i.classList.add("remove-button"),i.setAttribute("aria-label",this.#o.l10n.removeFile),i.addEventListener("click",(()=>{this.reset()})),this.#p.append(i),this.#d.append(this.#p),this.#b=new s({l10n:{uploadProgress:this.#o.l10n.uploadProgress}}),this.hideProgress(),this.#d.append(this.#b.getDOM()),this.#c=document.createElement("p"),this.#c.classList.add("status"),this.#c.innerText=this.#o.l10n.orDragTheFileHere,this.#d.append(this.#c)}#I(e={}){e.name&&(this.#k(),this.#m.innerText=e.name,e.size&&(this.#g.innerText=`${(e.size/1024).toFixed(2)} KB`),this.file=e,this.#h.classList.add("display-none"),this.#p.classList.remove("display-none"))}getFile(){return this.file}#w(){this.#n=!1,this.#d.removeAttribute("disabled")}#k(){this.#n=!0,this.#d.setAttribute("disabled","disabled")}reset(){this.#l&&(this.#l.abort(),this.#l=null),delete this.file,this.#p.classList.add("display-none"),this.#h.classList.remove("display-none"),this.setStatus(this.#o.l10n.orDragTheFileHere),this.hideProgress(),this.#w(),this.#r.reset()}setStatus(e="",t=""){this.#c.classList.toggle("display-none",!e),this.#c.classList.toggle("error","error"===t),this.#c.classList.toggle("pulse","pulse"===t),"string"==typeof e?this.#c.innerText=e:Array.isArray(e)&&(this.#c.innerHTML="",e.forEach((e=>{if("string"!=typeof e||""===e.trim())return;const t=document.createElement("p");t.innerText=e,this.#c.append(t)})))}showProgress(){this.#b.show()}hideProgress(){this.#b.hide()}setProgress(e){this.#b.setProgress(e)}#v(e){this.#n||e.target===this.#d&&(this.#u.click(),this.#d.classList.add("active"))}#y(e){e?.preventDefault(),this.#d.classList.add("dragging")}#E(){this.#d.classList.remove("dragging")}#x(e){e.preventDefault(),e?.dataTransfer.files.length&&(this.#d.classList.remove("dragging"),this.upload(e.dataTransfer.files))}#L(e){this.#C(e.target.files[0])}upload(e){this.#u.files=e,this.#C(this.#u.files[0])}#C(e){if(!e)return;this.#I(e),this.#u.value="",this.#d.classList.remove("active"),this.#l=new AbortController;const t={file:e,signal:this.#l.signal};this.#o.sessionKeyName&&this.#o.sessionKeyValue&&(t.session={key:this.#o.sessionKeyName,value:this.#o.sessionKeyValue}),this.#r.upload(t)}}const a=100,n={5:"good",10:"neutral",100:"bad"};class l{#t;#S;#D;#o;constructor(e={}){this.#o=e,"number"==typeof e.size&&(e.size=`${e.size}px`),this.#o.size=e.size??"5rem",this.#o.strokeWidth=e.strokeWidth??"0.5rem",this.#o.max=e.max??a,this.#t=document.createElement("div"),this.#t.classList.add("progress-circle-container"),this.#t.style.setProperty("--size",this.#o.size),this.#t.style.setProperty("--stroke-width",this.#o.strokeWidth);const t=document.createElement("button");t.classList.add("progress-circle-wrapper"),t.setAttribute("tabindex","-1"),t.addEventListener("click",(()=>{window.location.href=this.#o.link})),this.#t.append(t);const s=document.createElementNS("http://www.w3.org/2000/svg","svg");s.classList.add("progress-circle"),s.setAttribute("width","100%"),s.setAttribute("height","100%"),t.append(s);const i=document.createElementNS("http://www.w3.org/2000/svg","circle");i.setAttribute("class","progress-circle-background"),s.append(i);const n=document.createElementNS("http://www.w3.org/2000/svg","circle");n.setAttribute("class","progress-circle-foreground"),s.append(n),this.setColor(this.#o.color),this.#S=document.createElement("span"),this.#S.classList.add("progress-circle-value"),this.setValue(this.#o.value,this.#o.max,this.#o.percentage),t.append(this.#S),this.#D=document.createElement("span"),this.#D.classList.add("progress-circle-label"),this.setLabel(this.#o.label,this.#o.link),this.#t.append(this.#D)}getDOM(){return this.#t}setValue(e,t=100,s=!0){"number"==typeof e&&(("number"!=typeof t||t<0)&&(t=a),"boolean"!=typeof s&&(s=!0),e=Math.max(0,Math.min(t,e)),s&&(e=e/t*a),e=Math.round(e),this.#o.value=e,s?this.#t.style.setProperty("--progress",e):this.#t.style.setProperty("--progress",e/t*a),this.#t.classList.toggle("empty",0===e),this.#S.innerText=s?`${e}%`:`${e}`,0===e?this.setColor("transparent"):this.setColor(this.#o.color))}setLabel(e,t){"string"==typeof e&&("string"!=typeof t?this.#D.innerText=e:this.#D.innerHTML=`<a href="${t}">${e}</a>`)}setColor(e){if("string"==typeof e&&(this.#t.style.setProperty("--stroke-color",e),"transparent"!==e&&"status"!==e&&(this.#o.color=e),"status"===e)){const e=this.#o.value/this.#o.max*a;for(const t in n)if(e<=t){this.#t.style.setProperty("--stroke-color",`var(--color-status-${n[t]})`);break}}}}class o{#t;#F;#V={};constructor(e={}){this.#t=document.createElement("div"),this.#t.classList.add("results-row");const t=document.createElement("div");t.classList.add("overview"),this.#t.append(t);const s=document.createElement("div");s.classList.add("overview-header"),s.textContent=e.header,t.append(s),this.#F=document.createElement("div"),this.#F.classList.add("overview-value"),this.#F.textContent=e.value,t.append(this.#F);const i=document.createElement("div");i.classList.add("progress-circles"),this.#t.append(i),e.items.forEach((e=>{const t=new l({id:e.id,value:e.value,max:e.max,percentage:e.percentage,label:e.label,link:e.link,color:e.color});i.append(t.getDOM()),this.#V[e.id]=t}))}getDOM(){return this.#t}update(e={}){"number"==typeof e.messageCount&&e.items&&(this.#F.textContent=e.messageCount,Object.keys(this.#V).forEach((t=>{const s=e.items.find((e=>e.id===t));s?this.#V[t].setValue(s.value,s.max,s.percentage):this.#V[t].setValue(0,e.messageCount,!1)})))}}class r{#t;#A;#o;#r;#T;constructor(e={},t={}){this.#o=e,this.#r=t,this.#r.onResultsTypeChanged=this.#r.onResultsTypeChanged??(()=>{}),this.#r.onDownload=this.#r.onDownload??(()=>{}),this.#T=this.#M(this.#o.results),this.#t=document.createElement("div"),this.#t.classList.add("results"),this.#t.classList.add("block-visible");const s=document.createElement("div");s.classList.add("results-header"),s.textContent=e.l10n.results,this.#t.append(s),this.#A=document.createElement("div"),this.#A.classList.add("results-box"),this.#t.append(this.#A),this.#A.append(this.#T[Object.keys(this.#o.results)[0]].getDOM()),this.#A.append(this.#O())}getDOM(){return this.#t}update(e){for(const t in e)this.#T[t].update({messageCount:e[t].value,items:e[t].items})}toggleDownloadButton(e){"boolean"!=typeof e&&(e=!0===this.downloadButton.disabled),this.buttonDownload.disabled=!e}#M(e){const t={};for(const s in e)t[s]=new o(e[s]);return t}#O(){const e=document.createElement("div");e.classList.add("navigation-row");const s=document.createElement("select");s.name="select-results-type",s.setAttribute("aria-label",this.#o.l10n.changeSortingGrouping),s.classList.add("select-results-type"),s.addEventListener("change",(e=>{this.#U(e)})),e.append(s);for(const e in this.#o.results){const i=document.createElement("option");i.value=e;const a=this.#o.results[e].type,n=t(this.#o.results[e].label??e);i.textContent="filter"===a?`${this.#o.l10n.filterBy}: ${n}`:"group"===a?`${this.#o.l10n.groupBy}: ${n}`:n,s.append(i)}return this.buttonDownload=document.createElement("button"),this.buttonDownload.classList.add("button-download"),this.buttonDownload.textContent=this.#o.l10n.downloadEditedH5P,this.buttonDownload.addEventListener("click",(()=>{this.#r.onDownload()})),e.append(this.buttonDownload),this.toggleDownloadButton(!1),e}#U(e){this.#A.querySelector(".results-row").remove(),this.#A.prepend(this.#T[e.target.value].getDOM()),this.#r.onResultsTypeChanged(e.target.value)}}class d{#t;#P;#B;#$;#N;#z;constructor(e={},t={},s={}){this.#P=s,this.#B=e.uuid,this.#N=e.semanticsPath||"",this.#z=e.filePath||"",this.#$=e.initialValue,this.#t=document.createElement("div"),this.#t.classList.add("message-content-input-field")}getDOM(){return this.#t}getUUIDs(){return[this.#B]}getFactory(){return this.#P}getInitialValue(){return this.#$}getValue(){}setValue(e,t=""){}getEdits(){return this.hasEdits()?[{uuid:this.#B,semanticsPath:this.#N,...this.#z&&{filePath:this.#z},value:this.getValue()}]:[]}hasEdits(){return this.getValue()!==this.#$}makeCurrentValuesInitial(){this.#$=this.getValue()}}class c extends d{#R;constructor(e={},t={},s={}){super(e,t,s),this.getDOM().append(this.#K(e,t))}getValue(){return this.#R.value}setValue(e,t){"string"!=typeof t&&"number"!=typeof t||this.getUUIDs().some((t=>e.includes(t)))&&(this.#R.value=t)}#K(e,t){return this.#R=document.createElement("input"),this.#R.classList.add("message-content-item-input-text"),this.#R.setAttribute("type","text"),e.pattern&&this.#R.setAttribute("pattern",JSON.parse(`"${e.pattern}"`)),e.placeholder&&this.#R.setAttribute("placeholder",e.placeholder),t.onEdit&&this.#R.addEventListener("input",(()=>{t.onEdit(this.getUUIDs(),this.getValue())})),this.#R}toggleValidity(e){e?this.#R.classList.remove("invalid"):this.#R.classList.add("invalid")}}class h extends d{#H;constructor(e={},t={},s={}){super(e,t,s),this.getDOM().append(this.#K(e,t))}getValue(){return this.#H.value}setValue(e,t){"string"!=typeof t&&"number"!=typeof t||this.getUUIDs().some((t=>e.includes(t)))&&(this.#H.innerText=t)}#K(e,t){if(this.#H=document.createElement("textarea"),this.#H.classList.add("message-content-item-input-text-area"),this.#H.setAttribute("type","text"),e.pattern){const t=e.pattern.match(/(\d+)/g),s=t?Math.max(...t.map(Number)):0;s>0&&this.#H.setAttribute("maxlength",s)}return e.placeholder&&this.#H.setAttribute("placeholder",e.placeholder),t.onEdit&&this.#H.addEventListener("input",(()=>{t.onEdit(this.getUUIDs(),this.getValue())})),this.setValue(this.getUUIDs()[0],e.initialValue),this.#H}toggleValidity(e){e?this.#H.classList.remove("invalid"):this.#H.classList.add("invalid")}}class u extends d{#G;#W=[];#Y=null;constructor(e={},t={},s={}){super(e,t,s),this.getDOM().append(this.#K(e,t)),this.#q(e.fields)?(this.#Y="license",this.#j()):this.#J(e.fields)&&(this.#Y="change")}getUUIDs(){return this.#W.map((e=>e.getUUIDs())).flat()}getValue(){return this.#W.map((e=>e.getValue()))}setValue(e,t){"string"!=typeof t&&"number"!=typeof t||this.getUUIDs().some((t=>e.includes(t)))&&this.#W.forEach((s=>{s.setValue(e,t)}))}getEdits(){return this.hasEdits()?this.#W.map((e=>e.getEdits())).flat():[]}hasEdits(){return this.#W.some((e=>e.hasEdits()))}#K(e={},t={}){return this.#G=document.createElement("div"),this.#G.classList.add("message-content-item-input-group"),e.fields.forEach((e=>{const s=document.createElement("div");s.classList.add("message-content-item-input-group-wrapper"),this.#G.append(s);const i=document.createElement("label");i.classList.add("message-content-item-input-group-label"),i.innerText=e.label,s.append(i);const a=this.getFactory(),n=a.produce(e,{onEdit:(e,s)=>{"license"===this.#Y?this.#j(e,s):"change"===this.#Y&&this.#_(e,s),t.onEdit?.(e,s)}},a);this.#W.push(n),s.append(n.getDOM())})),this.#G}#j(){const e=this.#W[0].getValue();["CC BY","CC BY-SA","CC BY-NC","CC BY-NC-SA","CC BY-ND","CC BY-NC-ND"].includes(e)?(this.#W[1].toggleEnabled(!0),this.#W[1].toggleValidity(""!==this.#W[1].getValue())):(this.#W[1].toggleEnabled(!1),this.#W[1].setValue(this.#W[1].getUUIDs(),""),this.#W[1].toggleValidity(!0))}#_(e,t){const s=this.#W.every((e=>""===(e.getValue()??""))),i=this.#W.every((e=>""!==(e.getValue()??"")));s||i?this.#W.forEach((e=>{e.toggleValidity(!0)})):this.#W.forEach((e=>{const t=""!==(e.getValue()??"");e.toggleValidity(t)}))}makeCurrentValuesInitial(){this.#W.forEach((e=>{e.makeCurrentValuesInitial()}))}#X(e,t,s){return e?.type===t&&e?.semanticsPath?.endsWith(s)}#q(e){return this.#X(e[0],"select","license")&&this.#X(e[1],"select","licenseVersion")}#J(e){return this.#X(e[0],"date","date")&&this.#X(e[1],"text","author")&&this.#X(e[2],"textarea","log")}}class p extends d{#Q=[];#R;constructor(e={},t={},s={}){super(e,t,s),this.#Q=e.options||[],this.getDOM().append(this.#K(e,t))}getValue(){return this.#R.value}setValue(e,t){"string"!=typeof t&&"number"!=typeof t||this.getUUIDs().some((t=>e.includes(t)))&&this.#Q.some((e=>e.value===t))&&(this.#R.value=t)}#K(e,t){return this.#R=document.createElement("select"),this.#R.classList.add("message-content-item-input-select"),e.options.forEach((e=>{const t=document.createElement("option");t.value=e.value,t.textContent=e.label,this.#R.appendChild(t)})),t.onEdit&&this.#R.addEventListener("change",(()=>{t.onEdit(this.getUUIDs(),this.getValue())})),e.options.some((e=>e.value===this.getInitialValue()))&&(this.#R.value=this.getInitialValue()),this.#R}toggleEnabled(e){e?this.#R.removeAttribute("disabled"):this.#R.setAttribute("disabled","true")}toggleValidity(e){e?this.#R.classList.remove("invalid"):this.#R.classList.add("invalid")}}class m extends d{#R;constructor(e={},t={},s={}){super(e,t,s),this.getDOM().append(this.#K(e,t))}getValue(){if(!this.#R.value)return this.getInitialValue();const e=new Date(this.#R.value);return`${String(e.getDate()).padStart(2,"0")}-${String(e.getMonth()+1).padStart(2,"0")}-${e.getFullYear().toString().slice(-2)} ${String(e.getHours()).padStart(2,"0")}:${String(e.getMinutes()).padStart(2,"0")}:${String(e.getSeconds()).padStart(2,"0")}`}setValue(e,t){if("string"!=typeof t&&"number"!=typeof t)return;if(!this.getUUIDs().some((t=>e.includes(t))))return;if(""===t)return;const s=t.split(" ")[0].split("-"),i=t.split(" ")[1].split(":"),a=new Date(s[2],s[1]-1,s[0],i[0],i[1],i[2]||0).toISOString().slice(0,16);this.#R.value=a}#K(e,t){return this.#R=document.createElement("input"),this.#R.classList.add("message-content-item-input-date"),this.#R.setAttribute("type","datetime-local"),t.onEdit&&this.#R.addEventListener("input",(()=>{t.onEdit(this.getUUIDs(),this.getValue())})),this.#R}toggleValidity(e){e?this.#R.classList.remove("invalid"):this.#R.classList.add("invalid")}}class g extends d{#R;#Z;#ee;constructor(e={},t={},s={}){super(e,t,s),this.#Z=e.valueTrue??!0,this.#ee=e.valueFalse??!1,this.getDOM().append(this.#K(e,t))}getValue(){return this.#R.checked?this.#Z:this.#ee}setValue(e,t){"boolean"==typeof t&&this.getUUIDs().some((t=>e.includes(t)))&&(this.#R.checked=t)}#K(e,t){const s=document.createElement("fieldset");s.classList.add("message-content-item-input-boolean-fieldset"),this.#R=document.createElement("input"),this.#R.classList.add("message-content-item-input-boolean"),this.#R.setAttribute("type","checkbox"),this.#R.setAttribute("id",this.getUUIDs()[0]),s.append(this.#R);const i=document.createElement("label");return i.classList.add("message-content-item-input-boolean-label"),i.setAttribute("for",this.getUUIDs()[0]),i.innerText=e.checkboxLabel??"",s.append(i),t.onEdit&&this.#R.addEventListener("input",(()=>{t.onEdit(this.getUUIDs(),this.getValue())})),s}toggleValidity(e){e?this.#R.classList.remove("invalid"):this.#R.classList.add("invalid")}}class b{static produce(e={},t={}){switch(e.type){case"text":return new c(e,t,this);case"textarea":return new h(e,t,this);case"group":return new u(e,t,this);case"select":return new p(e,t,this);case"date":return new m(e,t,this);case"boolean":return new g(e,t,this);default:throw new Error(`Unknown input field type: ${e.type}`)}}}class f{#t;#te;#o;#r;#se;#ie;#ae=[];constructor(e={},t={}){if(this.#t=document.createElement("div"),this.#t.classList.add("message-content"),this.#te=e.message.subContentId??e.message.details?.subContentId,this.#o=JSON.parse(JSON.stringify(e)),this.#r=t??{},this.#r.onEdit=this.#r.onEdit??(()=>{}),this.#o.message.description){const e=document.createElement("div");e.classList.add("message-content-item");const t=document.createElement("p");t.classList.add("message-content-item-label"),t.innerText=this.#o.translations.description,e.append(t);const s=document.createElement("p");s.classList.add("message-content-item-text"),s.innerText=this.#o.message.description,e.append(s),this.#t.append(e)}if(this.#o.message.category){const e=document.createElement("div");e.classList.add("message-content-item");const t=document.createElement("p");t.classList.add("message-content-item-label"),t.innerText=this.#o.translations.category,e.append(t);const s=document.createElement("p");s.classList.add("message-content-item-text");let i=this.#o.translations[this.#o.message.category];this.#o.message.type&&(i=`${i} > ${this.#o.translations[this.#o.message.type]}`),s.innerText=i,e.append(s),this.#t.append(e)}if(this.#o.message.recommendation){const e=document.createElement("div");e.classList.add("message-content-item");const t=document.createElement("p");t.classList.add("message-content-item-label"),t.innerText=this.#o.translations.recommendation,e.append(t);const s=document.createElement("p");s.classList.add("message-content-item-text"),s.innerText=this.#o.message.recommendation,e.append(s),this.#t.append(e)}if(this.#o.message.editDirectly?.field?.type)try{const e=document.createElement("div");e.classList.add("message-content-item");const t=document.createElement("p");t.classList.add("message-content-item-label"),t.innerText=this.#o.message.editDirectly.field.label??this.#o.translations.editDirectly,e.append(t);const s=b.produce(this.#o.message.editDirectly.field,{onEdit:(e,t)=>{this.#r.onEdit(e,t)}});this.#ae.push(s),e.append(s.getDOM()),this.#t.append(e)}catch(e){}if("libreText"===this.#o.message.type){const e=`<h3>${this.#o.translations.status}</h3><p>${this.#o.message.details.status}</p>`;this.#o.message.details.description=`${this.#o.message.details.description}${e}`;const t=`<h3>${this.#o.translations.licenseNote}</h3><p>${this.#o.message.details.licenseNote}</p>`;this.#o.message.details.description=`${this.#o.message.details.description}${t}`;this.#ne(this.#o.message.details.description).forEach((e=>{const t=document.createElement("div");t.classList.add("message-content-item");const s=document.createElement("p");s.classList.add("message-content-item-label"),s.innerText=e.headline,t.append(s);const i=document.createElement("div");i.classList.add("message-content-details"),i.innerHTML=e.html,t.append(i),this.#t.append(t)}))}if(this.#o.message.details?.base64){const e=document.createElement("div");e.classList.add("message-content-item");const t=document.createElement("p");t.classList.add("message-content-item-label"),t.innerText=this.#o.translations.image,e.append(t);const s=document.createElement("img");s.classList.add("message-content-image"),s.src=this.#o.message.details.base64,e.append(s),this.#t.append(e)}if("libreText"!==this.#o.message.type&&this.#o.message.details){const e=document.createElement("div");e.classList.add("message-content-item"),this.#se=document.createElement("button"),this.#se.classList.add("message-content-details-button"),this.#se.addEventListener("click",(e=>{this.#le(e)})),e.append(this.#se),this.#ie=document.createElement("ul"),this.#ie.classList.add("message-content-details"),this.#ie.classList.add("display-none"),Object.keys(this.#o.message.details).forEach((e=>{if("reference"===e||"base64"===e)return;const t=document.createElement("li");t.classList.add("message-content-detail"),t.innerText=`${e}: ${this.#o.message.details[e]}`,this.#ie.append(t)})),e.append(this.#ie),this.#oe(!1),this.#t.append(e)}if(this.#o.message.details?.reference){const e=document.createElement("a");e.classList.add("message-content-reference"),e.href=this.#o.message.details.reference,e.target="_blank",e.innerText=this.#o.translations.learnMore,this.#t.append(e)}}getDOM(){return this.#t}getSubContentId(){return this.#te}setField(e,t){const s=this.#ae.find((t=>t.getUUIDs().some((t=>e.includes(t)))));s&&s.setValue(e,t)}getEdits(){return this.#ae.map((e=>e.getEdits())).flat()}makeCurrentValuesInitial(){this.#ae.forEach((e=>{e.makeCurrentValuesInitial()}))}#le(e){e.stopPropagation(),this.#oe()}#oe(e){e=!this.#ie.classList.toggle("display-none","boolean"==typeof e?!e:void 0),this.#se.innerText=e?this.#o.l10n.hideDetails:this.#o.l10n.showDetails}#ne(e){const t=(new DOMParser).parseFromString(e,"text/html").querySelectorAll("h2, h3, h4, h5, h6"),s=[];return t.forEach(((e,t)=>{const i=e.textContent.trim();let a="",n=e.nextElementSibling;for(;n&&!n.matches("h2, h3, h4, h5, h6");)a+=n.outerHTML,n=n.nextElementSibling;s.push({headline:i,html:a.trim()})})),s}}class v{#r;#t;#re;#de=!0;constructor(e={},t={}){this.#r=t??{},this.#r.onFieldEdit=this.#r.onFieldEdit??(()=>{}),this.#t=document.createElement("div"),this.#t.classList.add("carousel-item"),this.#t.setAttribute("role","group"),this.#t.setAttribute("aria-roledescription","slide"),this.#t.setAttribute("aria-labelledby",`carousel-item-summary-${e.carouselUuid}-${e.index}`);const s=document.createElement("div");s.classList.add("carousel-item-header"),this.#t.append(s);const i=document.createElement("span");i.setAttribute("id",`carousel-item-summary-${e.carouselUuid}-${e.index}`),i.classList.add("summary"),i.innerText=e.message.summary,s.append(i);const a=document.createElement("span");a.classList.add("level"),a.classList.add(e.message.level),a.innerText=e.message.level,s.append(a),this.#re=new f({message:e.message,translations:e.translations,l10n:e.l10n},{onEdit:(e,t)=>{this.#r.onFieldEdit(e,t)}}),this.#t.append(this.#re.getDOM())}getDOM(){return this.#t}getSubContentId(){return this.#re.getSubContentId()}toggleActive(e){this.#t.classList.toggle("active",e)}toggleAvailable(e){this.#de=e}isAvailable(){return this.#de}makeCurrentValuesInitial(){this.#re.makeCurrentValuesInitial()}updateField(e,t){this.#re.setField(e,t)}getEdits(){return this.#re.getEdits()}}class y{#r;#t;#ce=0;#F;#he=[];constructor(t={},s={}){const i=e();this.#r=s??{},this.#r.onFieldEdit=this.#r.onFieldEdit??(()=>{}),this.#t=document.createElement("section"),this.#t.setAttribute("id",`carousel-${i}`),this.#t.classList.add("h5p-caretaker-carousel"),this.#t.setAttribute("aria-roledescription","carousel"),this.#t.setAttribute("aria-label",t.ariaLabel);const a=document.createElement("div");a.classList.add("carousel-controls"),this.#t.append(a);const n=document.createElement("button");n.classList.add("carousel-button"),n.classList.add("previous"),n.setAttribute("aria-label",t.l10n.previousMessage),n.setAttribute("aria-controls",`carousel-items-${i}`),n.addEventListener("click",(e=>{e.stopPropagation(),this.#ue(this.#ce-1)})),a.append(n),this.#F=document.createElement("span"),this.#F.classList.add("carousel-count"),this.#F.setAttribute("aria-live","polite"),this.#F.style.setProperty("--count-width",2*t.messages.length.toString().length+3+"ch"),a.append(this.#F);const l=document.createElement("button");l.classList.add("carousel-button"),l.classList.add("next"),l.setAttribute("aria-label",t.l10n.nextMessage),l.setAttribute("aria-controls",`carousel-items-${i}`),l.addEventListener("click",(e=>{e.stopPropagation(),this.#ue(this.#ce+1)})),a.append(l);const o=document.createElement("div");o.setAttribute("id",`carousel-items-${i}`),o.classList.add("carousel-items"),this.#t.append(o),t.messages.forEach(((e,s)=>{const a=new v({message:e,index:s,carouselUuid:i,translations:t.translations,l10n:t.l10n},{onFieldEdit:(e,t)=>{this.#r.onFieldEdit(e,t)}});this.#he.push(a),o.append(a.getDOM())})),this.#ue(0)}getDOM(){return this.#t}getSubContentIds(){return this.#he.map((e=>e.getSubContentId()))}getNumberOfAvailableItems(){return this.#he.filter((e=>e.isAvailable())).length}filter(e){this.#he.forEach((t=>{t.toggleAvailable(e.includes(t.getSubContentId()))})),this.#ue(this.#ce)}#ue(e){if("number"!=typeof e)return;const t=-1===this.#ce||e===this.#ce?0:Math.sign(e-this.#ce);e=(e%this.#he.length+this.#he.length)%this.#he.length,this.#he[e].isAvailable()||(e=this.#pe(e,t)),this.#he.forEach(((t,s)=>{t.toggleActive(s===e)})),this.#ce=e,this.#me()}#pe(e,t){t=0===t?1:t;const s=this.#he.map((e=>e.isAvailable()));if(1===t){const t=s.indexOf(!0,e);return-1!==t?t:s.indexOf(!0)}{const t=s.lastIndexOf(!0,e);return-1!==t?t:s.lastIndexOf(!0)}}#me(){const e=this.#he.filter((e=>e.isAvailable())).findIndex((e=>e===this.#he[this.#ce]));this.#F.innerText=`${e+1} / ${this.getNumberOfAvailableItems()}`}makeCurrentValuesInitial(){this.#he.forEach((e=>{e.makeCurrentValuesInitial()}))}updateFields(e,t){this.#he.forEach((s=>{s.updateField(e,t)}))}getEdits(){return this.#he.map((e=>e.getEdits())).flat()}}class E{#t;#ge;#be;#fe;#F;#ve;#ye=!0;#r;constructor(t={},s={}){this.#r=s,this.#r.expandedStateChanged=this.#r.expandedStateChanged??(()=>{}),this.#r.onFieldEdit=this.#r.onFieldEdit??(()=>{}),this.#t=document.createElement("div"),this.#t.classList.add("type-accordion-panel");const i=`var(--type-accordion-panel-header-icon-${t.type}, var(--type-accordion-header-icon))`;this.#t.style.setProperty("--type-accordion-panel-header-icon",i);const a=e(),n=e(),l=document.createElement("div");l.classList.add("type-accordion-panel-header"),l.setAttribute("id",a),this.#be=document.createElement("button"),this.#be.classList.add("type-accordion-panel-button"),this.#be.setAttribute("aria-expanded","false"),this.#be.setAttribute("aria-controls",n),this.#be.innerText=t.translations[t.type],l.append(this.#be),this.#ve=document.createElement("span"),this.#ve.classList.add("type-accordion-panel-pending-indicator"),l.append(this.#ve),this.#F=document.createElement("span"),this.#F.classList.add("type-accordion-panel-count"),l.append(this.#F);const o=document.createElement("span");o.classList.add("type-accordion-panel-icon"),l.append(o),this.#t.append(l),this.#ge=document.createElement("div"),this.#ge.setAttribute("id",n),this.#ge.classList.add("type-accordion-panel-content-grid"),this.#ge.setAttribute("role","region"),this.#ge.setAttribute("aria-labelledby",a),this.#ge.setAttribute("hidden","");const r=document.createElement("div");r.classList.add("type-accordion-panel-content-wrapper"),this.#fe=new y({ariaLabel:t.translations[t.type],messages:t.messages,translations:t.translations,l10n:t.l10n},{onFieldEdit:(e,t)=>{const s=this.#fe.getEdits().length>0;this.#Ee(s),this.#r.onFieldEdit(e,t)}}),r.append(this.#fe.getDOM()),this.#ge.append(r),this.#t.append(this.#ge),this.#t.addEventListener("click",(e=>{null!==e.target.closest(".carousel-item")||this.toggle()})),this.#Ee(!1),this.updateMessageCount()}getDOM(){return this.#t}isVisible(){return this.#ye}isExpanded(){return"true"===this.#be.getAttribute("aria-expanded")}toggle(e){("boolean"==typeof e?e:"true"!==this.#be.getAttribute("aria-expanded"))?this.expand():this.collapse()}filter(e){this.#fe.filter(e),this.updateMessageCount(),!e||this.#fe.getNumberOfAvailableItems()>0?this.show():(this.collapse(),this.hide())}updateMessageCount(){this.#F.innerText=this.#fe.getNumberOfAvailableItems()}show(){this.#t.classList.remove("display-none"),this.#ye=!0}hide(){this.#t.classList.add("display-none"),this.#ye=!1}expand(){this.#ge.removeAttribute("hidden"),this.#be.setAttribute("aria-expanded","true"),this.#r.expandedStateChanged(!0)}collapse(){this.#ge.setAttribute("hidden",""),this.#be.setAttribute("aria-expanded","false"),this.#r.expandedStateChanged(!1)}makeCurrentValuesInitial(){this.#fe.makeCurrentValuesInitial()}clearPendingState(){this.#Ee(!1)}updateFields(e,t){this.#fe.updateFields(e,t)}getEdits(){return this.#fe.getEdits()}#Ee(e){this.#ve.classList.toggle("hidden",!e)}}class x{#r;#t;#xe;#Le=[];constructor(e={},t={}){this.#r=t??{},this.#r.onFieldEdit=this.#r.onFieldEdit??(()=>{}),this.#t=document.createElement("div"),this.#t.classList.add("type-accordion"),this.#t.style.setProperty("--type-accordion-header-icon",`var(--type-accordion-header-icon-${e.type})`);const s=document.createElement("a");s.classList.add("type-accordion-header-anchor"),s.setAttribute("name",`${e.type}`),this.#t.append(s);const i=document.createElement("div");i.classList.add("type-accordion-header"),this.#t.append(i);const a=document.createElement("p");a.classList.add("type-accordion-header-text"),a.innerText=e.header,i.append(a);const n=document.createElement("ul");n.classList.add("type-accordion-panels-list"),this.#t.append(n);[...new Set(e.messages.map((e=>e.type)))].forEach((t=>{const s=document.createElement("li");s.classList.add("type-accordion-panels-list-item");const i=new E({type:t,messages:e.messages.filter((e=>e.type===t)),translations:e.translations,l10n:{nextMessage:e.l10n.nextMessage,previousMessage:e.l10n.previousMessage,showDetails:e.l10n.showDetails,hideDetails:e.l10n.hideDetails}},{onFieldEdit:(e,t)=>{this.#r.onFieldEdit(e,t)}});this.#Le.push(i),s.append(i.getDOM()),n.append(s)})),this.#xe=document.createElement("div"),this.#xe.classList.add("type-accordion-all-filtered"),this.#xe.classList.add("display-none"),this.#xe.innerHTML=e.l10n.allFilteredOut,this.#t.append(this.#xe)}getDOM(){return this.#t}filter(e){this.#Le.forEach((t=>{t.filter(e)})),this.#Le.some((e=>e.isVisible()))?this.#xe.classList.add("display-none"):this.#xe.classList.remove("display-none")}makeCurrentValuesInitial(){this.#Le.forEach((e=>{e.makeCurrentValuesInitial()}))}clearPendingState(){this.#Le.forEach((e=>{e.clearPendingState()}))}updateFields(e,t){this.#Le.forEach((s=>{s.updateFields(e,t)}))}getEdits(){return this.#Le.map((e=>e.getEdits())).flat()}}class L{#r;#t;#Ie=[];constructor(e={},t={}){this.#r=t??{},this.#r.onFieldEdit=this.#r.onFieldEdit??(()=>{}),this.#t=document.createElement("div"),this.#t.classList.add("message-set"),e.sections.forEach((t=>{const s=e.messages.filter((s=>s[e.id]===t.id));if(!s.length)return;const i=new x({type:t.id,header:t.header,messages:s,translations:e.translations,l10n:e.l10n},{onFieldEdit:(e,t)=>{this.#r.onFieldEdit(e,t)}});this.#Ie.push(i),this.#t.append(i.getDOM())}))}getDOM(){return this.#t}filter(e){this.#Ie.forEach((t=>{t.filter(e)}))}show(){this.#t.classList.remove("display-none")}hide(){this.#t.classList.add("display-none")}makeCurrentValuesInitial(){this.#Ie.forEach((e=>{e.makeCurrentValuesInitial()}))}clearPendingState(){this.#Ie.forEach((e=>{e.clearPendingState()}))}updateFields(e,t){this.#Ie.forEach((s=>{s.updateFields(e,t)}))}getEdits(){return this.#Ie.map((e=>e.getEdits())).flat()}}class I{#t;#ke;#r;constructor(e={},t={}){this.#r=t??{},this.#r.onFieldEdit=this.#r.onFieldEdit??(()=>{}),this.#t=document.createElement("div"),this.#t.classList.add("message-sets"),this.#ke={};for(const t in e.sets)e.sets[t]=e.sets[t].filter((e=>"string"==typeof e||"string"==typeof e?.id)).map((t=>("string"==typeof t&&(t={id:t}),t.header=t.header??e.translations[t.id],t))),e.sets[t].length||delete e.sets[t];if(0!==Object.keys(e.sets).length){for(const t in e.sets)this.#ke[t]=new L({id:t,sections:e.sets[t],messages:e.messages,translations:e.translations,l10n:e.l10n},{onFieldEdit:(e,t)=>{this.#we(e,t)}}),this.#t.append(this.#ke[t].getDOM());this.show(Object.keys(this.#ke)[0])}}getDOM(){return this.#t}show(e){if(this.#ke[e])for(const t in this.#ke)t===e?this.#ke[t].show():this.#ke[t].hide()}filter(e){for(const t in this.#ke)this.#ke[t].filter(e)}makeCurrentValuesInitial(){for(const e in this.#ke)this.#ke[e].makeCurrentValuesInitial()}clearPendingState(){for(const e in this.#ke)this.#ke[e].clearPendingState()}getEdits(){const e=Object.keys(this.#ke).map((e=>this.#ke[e].getEdits())).flat();return[...new Map(e.map((e=>[e.uuid,e]))).values()]}#we(e,t){Object.keys(this.#ke).forEach((s=>{this.#ke[s].updateFields(e,t)})),this.#r.onFieldEdit()}}class k{#t;#Ce;#Se;#De;#Fe=!1;#Ve=!1;#ye=!1;#Ae=[];#o;constructor(t={}){this.#o=t;const s=e();this.#t=document.createElement("li"),this.#t.classList.add("content-filter-item"),this.#t.setAttribute("role","treeitem"),this.#t.setAttribute("tabindex","-1"),this.#t.setAttribute("aria-checked","true");const i=document.createElement("div");if(i.classList.add("content-filter-item-wrapper"),this.#t.append(i),this.#De=document.createElement("div"),this.#De.classList.add("content-filter-item-panel"),i.append(this.#De),this.#Ve=t.items?.length>0,this.#Ve){this.#De.classList.add("expandable"),this.#Ce=document.createElement("button"),this.#Ce.classList.add("content-filter-item-expander"),this.#Ce.setAttribute("tabindex","-1"),this.#De.append(this.#Ce),this.#t.setAttribute("aria-expanded",this.#Fe);const e=document.createElement("ul");e.classList.add("content-filter-group"),e.setAttribute("role","group"),i.append(e),t.items.forEach((s=>{const i=new k({...s,l10n:t.l10n});e.append(i.getDOM()),this.#Ae.push(i)})),this.toggleExpandedState(!1)}else{const e=document.createElement("div");this.#De.append(e)}this.#Se=document.createElement("input"),this.#Se.name=t.subcontentId,this.#Se.classList.add("content-filter-item-checkbox"),this.#Se.setAttribute("aria-labelledby",s),this.#Se.setAttribute("tabindex","-1"),this.#Se.type="checkbox",this.#Se.checked=!0,this.#De.append(this.#Se);const a=document.createElement("span");a.setAttribute("id",s),a.classList.add("content-filter-item-label"),a.innerText=t.label,this.#De.append(a)}getDOM(){return this.#t}getCheckboxDOM(){return this.#Se}getName(){return this.#o.name}getSubcontentId(){return this.#o.subcontentId}getLevel(){return this.#o.level}getLabel(){return this.#o.label}getItems(){return this.#Ae}getAllDescendantItems(){return this.#Te(this)}#Te(e){const t=[...e.getItems()];for(const s of e.getItems())t.push(...this.#Te(s));return t}isSelected(){return this.#Se.checked}isExpandable(){return this.#Ve}isExpanded(){return this.#Fe}isVisible(){return this.#ye}toggleSelectedState(e){e=e??!this.#Se.checked,this.#Se.checked=e,this.#Se.dispatchEvent(new Event("change",{bubbles:!0})),this.#t.setAttribute("aria-checked",e)}toggleTabbable(e){this.#t.setAttribute("tabindex",e?"0":"-1")}focus(){this.#t.focus()}toggleBorder(e,t){["top","bottom","left"].includes(e)&&"boolean"==typeof t&&this.#De.classList.toggle(`border-${e}`,t)}toggleExpandedState(e){this.#Ve&&(void 0===e&&(e=!this.#Fe),this.#t.setAttribute("aria-expanded",e),this.#Fe=e,e?this.#Ce.setAttribute("aria-label",this.#o.l10n.collapseList):this.#Ce.setAttribute("aria-label",this.#o.l10n.expandList),this.#Ae.forEach((t=>{t.toggleVisibility(e)})))}toggleVisibility(e){"boolean"==typeof e&&(this.#ye=e,this.#Ae.forEach((t=>{t.toggleVisibility(e&&this.isExpanded())})))}}class w{#t;#Me;#Oe;#Ue;#Ae=[];#r={};#Pe;constructor(e={},t={}){const s=(e,t=0)=>{e.level=t,e.items?.forEach((e=>{s(e,t+1)}))};s(e.item),this.#Ue=e.l10n,this.#r=t??{},this.#r.onFilterChange=this.#r.onFilterChange??(()=>{}),this.#t=document.createElement("div"),this.#t.classList.add("content-filter"),this.#t.classList.add("block-visible");const i=document.createElement("div");i.classList.add("content-filter-header");const a=document.createElement("span");a.classList.add("content-filter-header-intro"),a.innerHTML=this.#Ue.filterByContent,i.append(a),this.#Me=document.createElement("span"),this.#Me.classList.add("content-filter-header-selected"),this.#Me.innerHTML=this.#Ue.showAll,i.append(this.#Me),this.#Oe=document.createElement("button"),this.#Oe.classList.add("button-reset"),this.#Oe.classList.add("display-none"),this.#Oe.textContent=this.#Ue.reset,this.#Oe.addEventListener("click",(()=>{this.#Be()})),i.append(this.#Oe),this.#t.append(i);const n=document.createElement("ul");n.classList.add("content-filter-tree"),n.setAttribute("role","tree"),n.setAttribute("aria-multiselectable","true"),n.setAttribute("aria-label",this.#Ue.contentFilter),this.#t.append(n);const l=new k({...e.item,l10n:{expandList:e.l10n.expandList,collapseList:e.l10n.collapseList}});l.toggleVisibility(!0),n.append(l.getDOM()),this.#Ae=this.flattenItems(l),this.#t.addEventListener("click",(e=>{this.#v(e)})),this.#t.addEventListener("change",(e=>{this.#$e(e)})),this.#t.addEventListener("keydown",(e=>{this.#Ne(e)})),this.#Pe=this.#Ae[0],this.#Pe.toggleTabbable(!0),this.#ze()}flattenItems(e,t=[]){return t.push(e),e.getItems().forEach((e=>{this.flattenItems(e,t)})),t}getDOM(){return this.#t}#v(e){if(e.target.classList.contains("content-filter-item-wrapper")||e.target.classList.contains("content-filter-item-checkbox"))return;const t=this.#Ae.find((t=>t.getDOM()===e.target.closest(".content-filter-item")));t&&(t.toggleExpandedState(),this.#ze())}#$e(e){if(!e.target.classList.contains("content-filter-item-checkbox"))return;const t=this.#Ae.find((t=>t.getCheckboxDOM()===e.target));t.getAllDescendantItems().forEach((e=>{e.toggleSelectedState(t.isSelected())})),this.#Re()}#Ne(e){if("Enter"!==e.code&&"Space"!==e.code||this.#Pe.toggleSelectedState(),"ArrowRight"===e.code){if(!this.#Pe.isExpandable())return;this.#Pe.isExpanded()?this.#Ke(this.#He()):(this.#v(e),e.preventDefault())}else if("ArrowLeft"===e.code)this.#Pe.isExpandable()&&this.#Pe.isExpanded()?(this.#v(e),e.preventDefault()):this.#Ke(this.#Ge());else if("ArrowDown"===e.key)this.#Ke(this.#He()),e.preventDefault();else if("ArrowUp"===e.key)this.#Ke(this.#We()),e.preventDefault();else if("Home"===e.key)this.#Ke(this.#Ye()[0]);else if("End"===e.key)this.#Ke(this.#Ye().slice(-1)[0]);else if("*"===e.key){if(!this.#Pe.isExpandable())return;[...this.#Pe,...this.#qe(this.#Pe)].filter((e=>e.isExpandable())).forEach((e=>{e.toggleExpandedState(!0)})),this.#ze()}else if(1===e.key.length&&e.key.match(/\S/)&&!e.ctrlKey&&!e.metaKey){const t=this.#Ye().indexOf(this.#Pe),s=this.#Ye().slice(t+1).find((t=>t.getLabel().toLowerCase().startsWith(e.key.toLowerCase())));s&&this.#Ke(s)}}#Re(){const e=this.#Ae.filter((e=>e.isSelected()));let t;0===e.length?(t=this.#Ue.showNone,this.#Oe.classList.remove("display-none")):e.length===this.#Ae.length?(t=this.#Ue.showAll,this.#Oe.classList.add("display-none")):(t=this.#Ue.showSelected,this.#Oe.classList.remove("display-none")),this.#Me.innerHTML=t,this.#r.onFilterChange(e.map((e=>e.getSubcontentId())))}#Be(){this.#Ae.forEach((e=>{e.toggleSelectedState(!0)})),this.#Re()}#Ke(e){e&&(this.#Pe.toggleTabbable(!1),this.#Pe=e,this.#Pe.toggleTabbable(!0),this.#Pe.focus())}#qe(e){if(!e||!e.isVisible())return[];const t=this.#Ye(),s=t.indexOf(e),i=e.getLevel(),a=e=>{const t=[];for(const s of e){const e=s.getLevel();if(e===i)t.push(s);else if(e<i)break}return t};return[...a(t.slice(0,s).reverse()),...a(t.slice(s+1))]}#Ye(){return this.#Ae.filter((e=>e.isVisible()))}#Ge(){const e=this.#Ye();for(let t=e.indexOf(this.#Pe)-1;t>=0;t--)if(e[t].isExpandable())return e[t];return null}#We(){const e=this.#Ye(),t=e.indexOf(this.#Pe);return-1===t||0===t?null:e[t-1]}#He(){const e=this.#Ye(),t=e.indexOf(this.#Pe);return-1===t||t===e.length-1?null:e[t+1]}#ze(){this.#Ye().forEach(((e,t,s)=>{e.toggleBorder("top",0===t||e.getLevel()<s[t-1].getLevel()),e.toggleBorder("bottom",t!==s.length-1&&e.getLevel()<=s[t+1].getLevel()),e.toggleBorder("left",0!==t)}))}}const C="locale",S={orDragTheFileHere:"or drag the file here",removeFile:"Remove file",selectYourLanguage:"Select your language",uploadProgress:"Upload progress",uploadYourH5Pfile:"Upload your H5P file",yourFileIsBeingChecked:"Your file is being checked ...",yourFileWasCheckedSuccessfully:"Your file check was completed.",instructions:"Now do all the changes that you deem necessary and download the edited version of your file.",totalMessages:"Total messages",issues:"issues",results:"results",filterBy:"Filter by",groupBy:"Group by",download:"Download",downloadEditedH5P:"Download edited H5P",allFilteredOut:"All messages have been filtered out by content.",contentFilter:"Content filter",showAll:"Show all",showSelected:"Various selected contents",showNone:"Show none",filterByContent:"Filter by content:",reset:"Reset",showDetails:"Show details",hideDetails:"Hide details",unknownError:"Something went wrong, but I dunno what, sorry!",checkServerLog:"Please check the server log.",expandList:"Expand list",collapseList:"Collapse list",changeSortingGrouping:"Change sorting/grouping",nextMessage:"Next message",previousMessage:"Previous message"},D=200,F=300;window.H5PCaretaker=class{#d;#je;#ke;#Je;#_e;#Xe;#Ue;#r={};constructor(e={},t={}){if(this.#Ue={...S,...window.H5P_CARETAKER_L10N,...e.l10n},this.#Je=e.endpoint,this.#_e=e.sessionKeyName,this.#Xe=e.sessionKeyValue,!this.#Je){const e=document.querySelector(".h5p-caretaker");this.#Je=e?.dataset.uploadEndpoint??"./upload"}this.#r=t,this.#r.onInitialized=this.#r.onInitialized??(()=>{}),this.#r.onUploadStarted=this.#r.onUploadStarted??(()=>{}),this.#r.onUploadEnded=this.#r.onUploadEnded??(()=>{}),this.#r.onReset=this.#r.onReset??(()=>{}),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",(()=>{this.#Qe()})):this.#Qe()}#Qe(){const e=document.querySelector(".h5p-caretaker .select-language");e?.setAttribute("aria-label",S.selectYourLanguage),e?.addEventListener("change",(e=>{this.#Ze(e)})),this.#d=new i({selectorDropzone:".h5p-caretaker .dropzone",...this.#_e&&{sessionKeyName:this.#_e},...this.#Xe&&{sessionKeyValue:this.#Xe},l10n:{orDragTheFileHere:this.#Ue.orDragTheFileHere,removeFile:this.#Ue.removeFile,uploadProgress:this.#Ue.uploadProgress,uploadYourH5Pfile:this.#Ue.uploadYourH5Pfile}},{upload:async e=>{this.#et(e)},reset:()=>{this.#Be()}}),window.setTimeout((()=>{this.#r.onInitialized()}),0)}async uploadByURL(e){if(this.#Be(),"string"==typeof e){e=encodeURI(e);try{const t=await fetch(e),s=await t.arrayBuffer(),i=new Uint8Array(s),a=e.split("/").pop(),n=new File([i],a,{type:"application/zip"}),l=new DataTransfer;l.items.add(n),this.#d.upload(l.files)}catch(e){this.#r.onUploadEnded(!1)}}else this.#r.onUploadEnded(!1)}#tt(e={}){e.changes=e.changes??[];const t=new FormData;t.append("file",e.file),e.session?.key&&e.session?.value&&t.append(e.session.key,e.session.value),t.append("sessionKeyName",this.#_e),t.set("locale",document.querySelector(".select-language")?.value??"en"),t.set("changes",JSON.stringify(e.changes));const s=new XMLHttpRequest;s.open("POST",this.#Je,!0),s.responseType="arraybuffer",s.addEventListener("load",(()=>{this.#st(s)})),s.send(t)}#et(e={}){this.#r.onUploadStarted();const t=new FormData;t.append("file",e.file),e.session?.key&&e.session?.value&&t.append(e.session.key,e.session.value),t.append("sessionKeyName",this.#_e),t.set("locale",document.querySelector(".select-language")?.value??"en"),this.#d.setStatus(""),this.#d.showProgress();const s=new XMLHttpRequest;if(s.open("POST",this.#Je,!0),s.upload.addEventListener("progress",(e=>{e.lengthComputable&&this.#it(e.loaded/e.total*100)})),s.addEventListener("load",(()=>{this.#at(s),this.#r.onUploadEnded(!0)})),s.addEventListener("error",(()=>{this.#nt(s.statusText)})),e.signal&&(e.signal.addEventListener("abort",(()=>{s.abort(),this.#r.onUploadEnded(!1)})),e.signal.aborted))return s.abort(),void this.#r.onUploadEnded(!1);s.send(t)}#Be(){const e=new URLSearchParams(window.location.search);for(const t of e.keys())t!==C&&e.delete(t);window.history.replaceState({},document.title,`${window.location.pathname}?${e.toString()}${window.location.hash}`),document.querySelector(".filter-tree").innerHTML="",document.querySelector(".output").innerHTML="",this.#je?.toggleDownloadButton(!1),this.#r.onReset()}#Ze(e){const t=new URLSearchParams(window.location.search);t.set(e.target.dataset.localeKey??C,e.target.value),window.location.href=`${window.location.pathname}?${t.toString()}${window.location.hash}`}#it(e){this.#d.setProgress(e),100===e&&(this.#d.hideProgress(),this.#d.setStatus(this.#Ue.yourFileIsBeingChecked,"pulse"))}#st(e){if(!(e.status>=D&&e.status<F))return void this.#nt(e.status);this.#ke.clearPendingState(),this.#ke.makeCurrentValuesInitial(),this.#je.toggleDownloadButton(!1);const t=new Blob([e.response],{type:"application/zip"}),s=URL.createObjectURL(t),i=document.createElement("a");i.href=s,i.download="file.h5p",i.style.display="none",document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(s)}#at(e){this.#d.hideProgress();const t=e.status>=D&&e.status<F;let s,i;if([s,i]=this.parseAnalysisResponse(e),!t||i)return void this.#nt(i);this.#Ue={...this.#Ue,...s.client.translations},this.#d.setStatus([this.#Ue.yourFileWasCheckedSuccessfully,this.#Ue.instructions]);const a=e=>{const t={label:e.label,subcontentId:e.subContentId};return Array.isArray(e.children)&&(t.items=e.children.map((e=>a(e)))),t},n=new w({item:a(s.contentTree),l10n:{contentFilter:this.#Ue.contentFilter,showAll:this.#Ue.showAll,showSelected:this.#Ue.showSelected,showNone:this.#Ue.showNone,filterByContent:this.#Ue.filterByContent,reset:this.#Ue.reset,expandList:this.#Ue.expandList,collapseList:this.#Ue.collapseList}},{onFilterChange:e=>{const t=this.#lt(s.messages.filter((t=>e.includes(t.subContentId))));this.#je.update(t),this.#ke.filter(e)}});document.querySelector(".filter-tree").append(n.getDOM()),s.messages=s.messages.map((e=>{e.issues=("error"===e.level||"caution"===e.level)&&"issues";const t=e.details?.path;return t&&t.startsWith("images/")?(e.details?.path&&e.details?.path.startsWith("images/")&&(e.details.base64=s.raw.media.images[t.split("/").pop()]?.base64),e):e})),this.#je=new r({results:this.#lt(s.messages),l10n:{results:this.#Ue.results,filterBy:this.#Ue.filterBy,groupBy:this.#Ue.groupBy,downloadEditedH5P:this.#Ue.downloadEditedH5P,changeSortingGrouping:this.#Ue.changeSortingGrouping}},{onResultsTypeChanged:e=>{this.#ke.show(e)},onDownload:()=>{const e={file:this.#d.getFile()};this.#_e&&this.#Xe&&(e.session={key:this.#_e,value:this.#Xe}),e.changes=this.#ke.getEdits().flat(),this.#tt(e)}}),document.querySelector(".output").append(this.#je.getDOM());const l=[...new Set(s.messages.map((e=>e.category)))];this.#ke=new I({sets:{level:["error","caution","info"],category:l,issues:[{id:"issues",header:this.#Ue.issues}]},messages:s.messages,translations:s.client.translations,l10n:{allFilteredOut:this.#Ue.allFilteredOut,nextMessage:this.#Ue.nextMessage,previousMessage:this.#Ue.previousMessage,showDetails:this.#Ue.showDetails,hideDetails:this.#Ue.hideDetails}},{onFieldEdit:()=>{const e=this.#ke.getEdits().length>0;this.#je.toggleDownloadButton(e)}}),document.querySelector(".output").append(this.#ke.getDOM())}parseAnalysisResponse(e){let t,s=null;try{t=JSON.parse(e.responseText)}catch(i){t=!1,s=this.#ot(e.responseText)}return t.error&&(s=t.error),[t,s]}#ot(e){return!e||((e="")=>/<\/?[^>]+(>|$)/.test(e))(e)?`${this.#Ue.unknownError} ${this.#Ue.checkServerLog}`:e}#lt(e){const s=[{id:"error",value:e.filter((e=>"error"===e.level)).length,max:e.length,label:t(this.#Ue.error),link:"#error",color:"var(--color-error)",percentage:!1},{id:"caution",value:e.filter((e=>"caution"===e.level)).length,max:e.length,label:t(this.#Ue.caution),link:"#caution",color:"var(--color-caution)",percentage:!1},{id:"info",value:e.filter((e=>"info"===e.level)).length,max:e.length,label:t(this.#Ue.info),link:"#info",color:"var(--color-info)",percentage:!1}],i=[...new Set(e.map((e=>e.category)))].map((s=>({id:s,value:e.filter((e=>e.category===s)).length,max:e.length,label:t(this.#Ue[s]),link:`#${s}`,color:"var(--color-primary)",percentage:!1})));return{level:{label:this.#Ue.level,header:this.#Ue.totalMessages,value:e.length,items:s,type:"group"},category:{label:this.#Ue.category,header:this.#Ue.totalMessages,value:e.length,items:i,type:"group"}}}#nt(e){this.#d.setStatus(e,"error"),this.#r.onUploadEnded(!1)}}})();