(()=>{"use strict";const e=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(e=>{const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})),t=e=>"string"!=typeof e?"":`${e[0].toUpperCase()}${e.slice(1)}`;class s{#e=0;#t;#s;#a;#i;constructor(e={}){this.#t=document.createElement("div"),this.#t.classList.add("progressbar-wrapper"),this.#s=document.createElement("div"),this.#s.setAttribute("role","progressbar"),this.#s.setAttribute("aria-label",e.l10n.uploadProgress),this.#s.classList.add("progressbar-background"),this.#t.appendChild(this.#s),this.#a=document.createElement("div"),this.#a.classList.add("progressbar-fill"),this.#s.appendChild(this.#a),this.#i=document.createElement("span"),this.#i.classList.add("progress-value"),this.#t.appendChild(this.#i),this.setProgress(0)}getDOM(){return this.#t}show(){this.#t.classList.remove("display-none")}hide(){this.#t.classList.add("display-none")}setProgress(e){"number"==typeof e&&(e=Math.max(0,Math.min(e,100)),this.#e=e,this.#t.setAttribute("aria-valuenow",this.#e),this.#a.style.width=`${this.#e}%`,this.#i.innerText=`${Math.floor(this.#e)}%`)}getProgress(){return this.#e}}class a{#n=!1;#l=null;#o;#r;#d;#c;#h;#p;#m;#u;#g;#b;constructor(e={},t={}){this.#o=e,this.#o.selectorDropzone&&(this.#r=t??{},this.#r.upload=this.#r.upload??(()=>{}),this.#r.reset=this.#r.reset??(()=>{}),this.#f())}#f(){if(this.#d=document.querySelector(this.#o.selectorDropzone),!this.#d)return;if(this.#d.innerHTML="",this.#d.addEventListener("click",(e=>{this.#x(e)})),this.#d.addEventListener("dragover",(e=>{this.#v(e)})),this.#d.addEventListener("dragleave",(()=>{this.#y()})),this.#d.addEventListener("drop",(e=>{this.#L(e)})),this.#h=document.createElement("div"),this.#h.classList.add("upload-wrapper"),this.#o.sessionKeyName&&this.#o.sessionKeyValue){const e=document.createElement("input");e.type="hidden",e.name=this.#o.sessionKeyName,e.value=this.#o.sessionKeyValue,this.#h.append(e)}this.#p=document.createElement("input"),this.#p.classList.add("file-input"),this.#p.id="file-input",this.#p.type="file",this.#p.accept=".h5p",this.#p.addEventListener("change",(e=>{this.#E(e)})),this.#h.append(this.#p);const e=document.createElement("label");e.classList.add("upload-button"),e.htmlFor="file-input",e.innerText=this.#o.l10n.uploadYourH5Pfile,this.#h.append(e),this.#d.append(this.#h),this.#m=document.createElement("div"),this.#m.classList.add("file-info"),this.#m.classList.add("display-none");const t=document.createElement("div");t.classList.add("file-data"),this.#m.append(t),this.#u=document.createElement("div"),this.#u.classList.add("file-name"),t.append(this.#u),this.#g=document.createElement("div"),this.#g.classList.add("file-value"),t.append(this.#g);const a=document.createElement("button");a.classList.add("remove-button"),a.setAttribute("aria-label",this.#o.l10n.removeFile),a.addEventListener("click",(()=>{this.reset()})),this.#m.append(a),this.#d.append(this.#m),this.#b=new s({l10n:{uploadProgress:this.#o.l10n.uploadProgress}}),this.hideProgress(),this.#d.append(this.#b.getDOM()),this.#c=document.createElement("p"),this.#c.classList.add("status"),this.#c.innerText=this.#o.l10n.orDragTheFileHere,this.#d.append(this.#c)}#w(e={}){e.name&&(this.#k(),this.#u.innerText=e.name,e.size&&(this.#g.innerText=`${(e.size/1024).toFixed(2)} KB`),this.#h.classList.add("display-none"),this.#m.classList.remove("display-none"))}#S(){this.#n=!1,this.#d.removeAttribute("disabled")}#k(){this.#n=!0,this.#d.setAttribute("disabled","disabled")}reset(){this.#l&&(this.#l.abort(),this.#l=null),this.#m.classList.add("display-none"),this.#h.classList.remove("display-none"),this.setStatus(this.#o.l10n.orDragTheFileHere),this.hideProgress(),this.#S(),this.#r.reset()}setStatus(e="",t=""){this.#c.classList.toggle("display-none",!e),this.#c.classList.toggle("error","error"===t),this.#c.classList.toggle("pulse","pulse"===t),this.#c.innerText=e}showProgress(){this.#b.show()}hideProgress(){this.#b.hide()}setProgress(e){this.#b.setProgress(e)}#x(e){this.#n||e.target===this.#d&&(this.#p.click(),this.#d.classList.add("active"))}#v(e){e?.preventDefault(),this.#d.classList.add("dragging")}#y(){this.#d.classList.remove("dragging")}#L(e){e.preventDefault(),e?.dataTransfer.files.length&&(this.#d.classList.remove("dragging"),this.upload(e.dataTransfer.files))}#E(e){this.#C(e.target.files[0])}upload(e){this.#p.files=e,this.#C(this.#p.files[0])}#C(e){if(!e)return;this.#w(e),this.#p.value="",this.#d.classList.remove("active"),this.#l=new AbortController;const t={file:e,signal:this.#l.signal};this.#o.sessionKeyName&&this.#o.sessionKeyValue&&(t.session={key:this.#o.sessionKeyName,value:this.#o.sessionKeyValue}),this.#r.upload(t)}}const i=100,n={5:"good",10:"neutral",100:"bad"};class l{#t;#I;#M;#o;constructor(e={}){this.#o=e,"number"==typeof e.size&&(e.size=`${e.size}px`),this.#o.size=e.size??"5rem",this.#o.strokeWidth=e.strokeWidth??"0.5rem",this.#o.max=e.max??i,this.#t=document.createElement("div"),this.#t.classList.add("progress-circle-container"),this.#t.style.setProperty("--size",this.#o.size),this.#t.style.setProperty("--stroke-width",this.#o.strokeWidth);const t=document.createElement("div");t.classList.add("progress-circle-wrapper"),this.#t.append(t);const s=document.createElementNS("http://www.w3.org/2000/svg","svg");s.classList.add("progress-circle"),s.setAttribute("width","100%"),s.setAttribute("height","100%"),t.append(s);const a=document.createElementNS("http://www.w3.org/2000/svg","circle");a.setAttribute("class","progress-circle-background"),s.append(a);const n=document.createElementNS("http://www.w3.org/2000/svg","circle");n.setAttribute("class","progress-circle-foreground"),s.append(n),this.setColor(this.#o.color),this.#I=document.createElement("span"),this.#I.classList.add("progress-circle-value"),this.setValue(this.#o.value,this.#o.max,this.#o.percentage),t.append(this.#I),this.#M=document.createElement("span"),this.#M.classList.add("progress-circle-label"),this.setLabel(this.#o.label,this.#o.link),this.#t.append(this.#M)}getDOM(){return this.#t}setValue(e,t=100,s=!0){"number"==typeof e&&(("number"!=typeof t||t<0)&&(t=i),"boolean"!=typeof s&&(s=!0),e=Math.max(0,Math.min(t,e)),s&&(e=e/t*i),e=Math.round(e),this.#o.value=e,s?this.#t.style.setProperty("--progress",e):this.#t.style.setProperty("--progress",e/t*i),this.#t.classList.toggle("empty",0===e),this.#I.innerText=s?`${e}%`:`${e}`,0===e?this.setColor("transparent"):this.setColor(this.#o.color))}setLabel(e,t){"string"==typeof e&&("string"!=typeof t?this.#M.innerText=e:this.#M.innerHTML=`<a href="${t}">${e}</a>`)}setColor(e){if("string"==typeof e&&(this.#t.style.setProperty("--stroke-color",e),"transparent"!==e&&"status"!==e&&(this.#o.color=e),"status"===e)){const e=this.#o.value/this.#o.max*i;for(const t in n)if(e<=t){this.#t.style.setProperty("--stroke-color",`var(--color-status-${n[t]})`);break}}}}class o{#t;#T;#D={};constructor(e={}){this.#t=document.createElement("div"),this.#t.classList.add("results-row");const t=document.createElement("div");t.classList.add("overview"),this.#t.append(t);const s=document.createElement("div");s.classList.add("overview-header"),s.textContent=e.header,t.append(s),this.#T=document.createElement("div"),this.#T.classList.add("overview-value"),this.#T.textContent=e.value,t.append(this.#T);const a=document.createElement("div");a.classList.add("progress-circles"),this.#t.append(a),e.items.forEach((e=>{const t=new l({id:e.id,value:e.value,max:e.max,percentage:e.percentage,label:e.label,link:e.link,color:e.color});a.append(t.getDOM()),this.#D[e.id]=t}))}getDOM(){return this.#t}update(e={}){"number"==typeof e.messageCount&&e.items&&(this.#T.textContent=e.messageCount,Object.keys(this.#D).forEach((t=>{const s=e.items.find((e=>e.id===t));s?this.#D[t].setValue(s.value,s.max,s.percentage):this.#D[t].setValue(0,e.messageCount,!1)})))}}class r{#t;#A;#o;#r;#$;constructor(e={},t={}){this.#o=e,this.#r=t,this.#r.onResultsTypeChanged=this.#r.onResultsTypeChanged??(()=>{}),this.#r.onDownload=this.#r.onDownload??(()=>{}),this.#$=this.#B(this.#o.results),this.#t=document.createElement("div"),this.#t.classList.add("results"),this.#t.classList.add("block-visible");const s=document.createElement("div");s.classList.add("results-header"),s.textContent=e.l10n.results,this.#t.append(s),this.#A=document.createElement("div"),this.#A.classList.add("results-box"),this.#t.append(this.#A),this.#A.append(this.#$[Object.keys(this.#o.results)[0]].getDOM()),this.#A.append(this.#O())}getDOM(){return this.#t}update(e){for(const t in e)this.#$[t].update({messageCount:e[t].value,items:e[t].items})}#B(e){const t={};for(const s in e)t[s]=new o(e[s]);return t}#O(){const e=document.createElement("div");e.classList.add("navigation-row");const s=document.createElement("select");s.name="select-results-type",s.classList.add("select-results-type"),s.addEventListener("change",(e=>{this.#z(e)})),e.append(s);for(const e in this.#o.results){const a=document.createElement("option");a.value=e;const i=this.#o.results[e].type,n=t(this.#o.results[e].label??e);a.textContent="filter"===i?`${this.#o.l10n.filterBy}: ${n}`:"group"===i?`${this.#o.l10n.groupBy}: ${n}`:n,s.append(a)}const a=document.createElement("button");return a.classList.add("button-download"),a.textContent=this.#o.l10n.download,a.addEventListener("click",(()=>{this.#r.onDownload()})),e.append(a),e}#z(e){this.#A.querySelector(".results-row").remove(),this.#A.prepend(this.#$[e.target.value].getDOM()),this.#r.onResultsTypeChanged(e.target.value)}}class d{#o;#t;#r;#R=!1;#V=!1;constructor(e={},t={}){this.#o=e,this.#o.l10n=this.#o.l10n??{},this.#o.l10n.expandAllMessages=this.#o.l10n.expandAllMessages??"Expand all messages",this.#o.l10n.collapseAllMessages=this.#o.l10n.collapseAllMessages??"Collapse all messages",this.#r=t,this.#r.expandedStateChanged=this.#r.expandedStateChanged??(()=>{}),this.#t=document.createElement("button"),this.#t.classList.add("expand-button"),this.#t.addEventListener("click",(()=>{this.toggle()})),this.#P()}getDOM(){return this.#t}toggle(e,t=!1){("boolean"==typeof e?e:!this.#R)?this.#F(t):this.#P(t)}#P(e=!1){this.#t.innerHTML=this.#o.l10n.expandAllMessages,this.#t.classList.remove("expanded"),this.#R=!1,e||this.#r.expandedStateChanged(this.#R)}#F(e=!1){this.#t.innerHTML=this.#o.l10n.collapseAllMessages,this.#t.classList.add("expanded"),this.#R=!0,e||this.#r.expandedStateChanged(this.#R)}setWidth=()=>{if(this.#V)return;const e=document.createElement("div");e.classList.add("offsite");const t=document.createElement("button");t.classList.add("expand-button"),t.innerHTML=this.#o.l10n.expandAllMessages,e.append(t);const s=document.createElement("button");s.classList.add("expand-button"),s.classList.add("expanded"),s.innerHTML=this.#o.l10n.collapseAllMessages,e.append(s),document.body.append(e),document.fonts.ready.then((()=>{const a=t.getBoundingClientRect().width,i=s.getBoundingClientRect().width;this.fixedButtonWidth=Math.ceil(Math.max(a,i)),this.#t.style.width=`${this.fixedButtonWidth}px`,this.#V=!0,e?.remove()}))};show(){this.#t.classList.remove("display-none")}hide(){this.#t.classList.add("display-none")}}class c{#t;#N;#o;#U;#H;constructor(e={}){if(this.#t=document.createElement("div"),this.#t.classList.add("message-content"),this.#N=e.message.subContentId,this.#o=JSON.parse(JSON.stringify(e)),this.#o.message.description){const e=document.createElement("div");e.classList.add("message-content-item");const t=document.createElement("p");t.classList.add("message-content-item-label"),t.innerText=this.#o.translations.description,e.append(t);const s=document.createElement("p");s.classList.add("message-content-item-text"),s.innerText=this.#o.message.description,e.append(s),this.#t.append(e)}if(this.#o.message.category){const e=document.createElement("div");e.classList.add("message-content-item");const t=document.createElement("p");t.classList.add("message-content-item-label"),t.innerText=this.#o.translations.category,e.append(t);const s=document.createElement("p");s.classList.add("message-content-item-text");let a=this.#o.translations[this.#o.message.category];this.#o.message.type&&(a=`${a} > ${this.#o.translations[this.#o.message.type]}`),s.innerText=a,e.append(s),this.#t.append(e)}if(this.#o.message.recommendation){const e=document.createElement("div");e.classList.add("message-content-item");const t=document.createElement("p");t.classList.add("message-content-item-label"),t.innerText=this.#o.translations.recommendation,e.append(t);const s=document.createElement("p");s.classList.add("message-content-item-text"),s.innerText=this.#o.message.recommendation,e.append(s),this.#t.append(e)}if("libreText"===this.#o.message.type){const e=`<h3>${this.#o.translations.status}</h3><p>${this.#o.message.details.status}</p>`;this.#o.message.details.description=`${this.#o.message.details.description}${e}`;const t=`<h3>${this.#o.translations.licenseNote}</h3><p>${this.#o.message.details.licenseNote}</p>`;this.#o.message.details.description=`${this.#o.message.details.description}${t}`;this.#K(this.#o.message.details.description).forEach((e=>{const t=document.createElement("div");t.classList.add("message-content-item");const s=document.createElement("p");s.classList.add("message-content-item-label"),s.innerText=e.headline,t.append(s);const a=document.createElement("div");a.classList.add("message-content-details"),a.innerHTML=e.html,t.append(a),this.#t.append(t)}))}if(this.#o.message.details?.base64){const e=document.createElement("div");e.classList.add("message-content-item");const t=document.createElement("p");t.classList.add("message-content-item-label"),t.innerText=this.#o.translations.image,e.append(t);const s=document.createElement("img");s.classList.add("message-content-image"),s.src=this.#o.message.details.base64,e.append(s),this.#t.append(e)}if("libreText"!==this.#o.message.type&&this.#o.message.details){const e=document.createElement("div");e.classList.add("message-content-item"),this.#U=document.createElement("button"),this.#U.classList.add("message-content-details-button"),this.#U.addEventListener("click",(e=>{this.#W(e)})),e.append(this.#U),this.#H=document.createElement("ul"),this.#H.classList.add("message-content-details"),this.#H.classList.add("display-none"),Object.keys(this.#o.message.details).forEach((e=>{if("reference"===e||"base64"===e)return;const t=document.createElement("li");t.classList.add("message-content-detail"),t.innerText=`${e}: ${this.#o.message.details[e]}`,this.#H.append(t)})),e.append(this.#H),this.#q(!1),this.#t.append(e)}if(this.#o.message.details?.reference){const e=document.createElement("a");e.classList.add("message-content-reference"),e.href=this.#o.message.details.reference,e.target="_blank",e.innerText=this.#o.translations.learnMore,this.#t.append(e)}}getDOM(){return this.#t}getSubContentId(){return this.#N}#W(e){e.stopPropagation(),this.#q()}#q(e){e=!this.#H.classList.toggle("display-none","boolean"==typeof e?!e:void 0),this.#U.innerText=e?this.#o.l10n.hideDetails:this.#o.l10n.showDetails}#K(e){const t=(new DOMParser).parseFromString(e,"text/html").querySelectorAll("h2, h3, h4, h5, h6"),s=[];return t.forEach(((e,t)=>{const a=e.textContent.trim();let i="",n=e.nextElementSibling;for(;n&&!n.matches("h2, h3, h4, h5, h6");)i+=n.outerHTML,n=n.nextElementSibling;s.push({headline:a,html:i.trim()})})),s}}class h{#t;#G;#Y;#J;#j=!0;#r;constructor(t={},s={}){this.#r=s,this.#r.expandedStateChanged=this.#r.expandedStateChanged??(()=>{}),this.#t=document.createElement("div"),this.#t.classList.add("message-accordion-panel");const a=e(),i=e(),n=document.createElement("div");n.classList.add("message-accordion-panel-header"),n.setAttribute("Id",a);const l=document.createElement("span");if(l.classList.add("message-accordion-panel-icon"),n.append(l),this.#Y=document.createElement("button"),this.#Y.classList.add("message-accordion-panel-button"),this.#Y.setAttribute("aria-expanded","false"),this.#Y.setAttribute("aria-controls",i),this.#Y.innerText=t.message.summary,n.append(this.#Y),t.message.level&&t.translations[t.message.level]){const e=document.createElement("span");e.classList.add("message-accordion-panel-level"),e.classList.add(t.message.level),e.innerText=t.translations[t.message.level],n.append(e)}this.#t.append(n),this.#G=document.createElement("div"),this.#G.setAttribute("Id",i),this.#G.classList.add("message-accordion-panel-content-grid"),this.#G.setAttribute("role","region"),this.#G.setAttribute("aria-labelledby",a),this.#G.setAttribute("hidden","");const o=document.createElement("div");o.classList.add("message-accordion-panel-content-wrapper"),this.#J=new c({message:t.message,translations:t.translations,l10n:t.l10n}),o.append(this.#J.getDOM()),this.#G.append(o),this.#t.append(this.#G),this.#t.addEventListener("click",(()=>{this.toggle()}))}getDOM(){return this.#t}isVisible(){return this.#j}isExpanded(){return"true"===this.#Y.getAttribute("aria-expanded")}toggle(e){("boolean"==typeof e?e:"true"!==this.#Y.getAttribute("aria-expanded"))?this.expand():this.collapse()}filter(e){!e||e.includes(this.#J.getSubContentId())?this.show():(this.collapse(),this.hide())}show(){this.#t.classList.remove("display-none"),this.#j=!0}hide(){this.#t.classList.add("display-none"),this.#j=!1}expand(){this.#G.removeAttribute("hidden"),this.#Y.setAttribute("aria-expanded","true"),this.#r.expandedStateChanged(!0)}collapse(){this.#G.setAttribute("hidden",""),this.#Y.setAttribute("aria-expanded","false"),this.#r.expandedStateChanged(!1)}}class p{#t;#_;#X;#Q=[];constructor(e={}){this.#t=document.createElement("div"),this.#t.classList.add("message-accordion");const t=document.createElement("a");t.classList.add("message-accordion-header-anchor"),t.setAttribute("name",`${e.type}`),this.#t.append(t);const s=document.createElement("div");s.classList.add("message-accordion-header"),this.#t.append(s);const a=document.createElement("p");a.classList.add("message-accordion-header-text"),a.innerText=e.header,s.append(a),this.#_=new d({l10n:{expandAllMessages:e.l10n.expandAllMessages,collapseAllMessages:e.l10n.collapseAllMessages}},{expandedStateChanged:e=>{this.#Q.forEach((t=>{t.toggle(e)}))}}),this.#_.setWidth(),s.append(this.#_.getDOM());const i=document.createElement("ul");i.classList.add("message-accordion-panels-list"),this.#t.append(i),e.messages.forEach((t=>{const s=document.createElement("li");s.classList.add("message-accordion-panels-list-item");const a=new h({message:t,translations:e.translations,l10n:{showDetails:e.l10n.showDetails,hideDetails:e.l10n.hideDetails}},{expandedStateChanged:e=>{this.#Q.every((e=>!e.isExpanded()))?this.#_.toggle(!1,!0):this.#_.toggle(!0,!0)}});s.append(a.getDOM()),this.#Q.push(a),i.append(s)})),this.#X=document.createElement("div"),this.#X.classList.add("message-accordion-all-filtered"),this.#X.classList.add("display-none"),this.#X.innerHTML=e.l10n.allFilteredOut,this.#t.append(this.#X)}getDOM(){return this.#t}filter(e){this.#Q.forEach((t=>{t.filter(e)})),this.#Q.some((e=>e.isVisible()))?(this.#_.show(),this.#X.classList.add("display-none")):(this.#_.hide(),this.#X.classList.remove("display-none"))}}class m{#t;#Z=[];constructor(e={}){this.#t=document.createElement("div"),this.#t.classList.add("message-set"),e.sections.forEach((t=>{const s=e.messages.filter((s=>s[e.id]===t.id));if(!s.length)return;const a=new p({type:t.id,header:t.header,messages:s,translations:e.translations,l10n:e.l10n});this.#Z.push(a),this.#t.append(a.getDOM())}))}getDOM(){return this.#t}filter(e){this.#Z.forEach((t=>{t.filter(e)}))}show(){this.#t.classList.remove("display-none")}hide(){this.#t.classList.add("display-none")}}class u{#t;#ee;constructor(e={}){this.#t=document.createElement("div"),this.#t.classList.add("message-sets"),this.#ee={};for(const t in e.sets)e.sets[t]=e.sets[t].filter((e=>"string"==typeof e||"string"==typeof e?.id)).map((t=>("string"==typeof t&&(t={id:t}),t.header=t.header??e.translations[t.id],t))),e.sets[t].length||delete e.sets[t];if(0!==Object.keys(e.sets).length){for(const t in e.sets)this.#ee[t]=new m({id:t,sections:e.sets[t],messages:e.messages,translations:e.translations,l10n:e.l10n}),this.#t.append(this.#ee[t].getDOM());this.show(Object.keys(this.#ee)[0])}}getDOM(){return this.#t}show(e){if(this.#ee[e])for(const t in this.#ee)t===e?this.#ee[t].show():this.#ee[t].hide()}filter(e){for(const t in this.#ee)this.#ee[t].filter(e)}}class g{#te;#se;#ae;constructor(e={}){this.#te=e.messages,this.#se=e.translations,this.#ae=e.title}get(e={}){return e.type=e.type??"markdown","markdown"===e.type?this.#ie():""}download(e={}){e.type=e.type??"markdown";const t=document.createElement("a");if("markdown"===e.type){if(t.href=`data:text/plain;charset=utf-8,${encodeURIComponent(this.#ie())}`,"string"==typeof e.filename&&e.filename.length>0)t.download=e.filename;else{const e=(new Date).toISOString().split(".")[0].replace(/[-T:]/g,"");t.download=`h5p-caretaker-report-${e}.txt`}t.style.display="none",document.body.append(t),t.click(),t.remove()}}#ie(){let e=`# ${this.#ae}\n\n`;const s=["error","caution","info"].filter((e=>this.#te.some((t=>t.level===e)))).map((e=>({headline:t(this.#se[e]),messages:this.#te.filter((t=>t.level===e))}))).reduce(((e,t)=>`${e}${`## ${t.headline}\n\n`}${t.messages.map((e=>this.#ne(e))).join("\n")}\n\n`),"");return`${e}${s}`}#ne(e){let s=`### ${e.summary}\n\n`;if(description){s=`${s}${`#### ${t(this.#se.description)}\n${e.description}\n`}\n`}if(s=`${s}${`#### ${t(this.#se.category)}\n${this.#se[e.category]} > ${this.#se[e.type]}\n`}\n`,e.recommendation){s=`${s}${`#### ${t(this.#se.recommendation)}\n${e.recommendation}\n`}\n`}if(e.details){let a=`#### ${t(this.#se.details)}\n`;for(const t in e.details)"base64"!==t&&(a="libreText"!==e.type||"description"!==t?`${a}* ${t}: ${e.details[t]}\n`:`${a}* ${this.#se[t]}: ${this.#le(e.details[t])}\n`);s=`${s}${a}`}return s}#le(e){e=e.replace(/<\/h[1-6]>/g,": ").replace(/<\/li>\n*<\/ul>/g," ").replace(/<\/li>/g,", ").replace(/\r?\n|\r/g," ");const t=document.createElement("div");return t.innerHTML=e,(t.textContent||t.innerText||"").replace(/\s+/g," ")}}class b{#t;#oe;#re;#de;#ce=!1;#he=!1;#j=!1;#pe=[];#o;constructor(e={}){this.#o=e,this.#t=document.createElement("li"),this.#t.classList.add("content-filter-item"),this.#t.setAttribute("role","treeitem"),this.#t.setAttribute("tabindex","-1"),this.#t.setAttribute("aria-checked","true");const t=document.createElement("div");if(t.classList.add("content-filter-item-wrapper"),this.#t.append(t),this.#de=document.createElement("div"),this.#de.classList.add("content-filter-item-panel"),t.append(this.#de),this.#he=e.items?.length>0,this.#he){this.#de.classList.add("expandable"),this.#oe=document.createElement("button"),this.#oe.classList.add("content-filter-item-expander"),this.#oe.setAttribute("tabindex","-1"),this.#de.append(this.#oe),this.#t.setAttribute("aria-expanded",this.#ce);const s=document.createElement("ul");s.classList.add("content-filter-group"),s.setAttribute("role","group"),t.append(s),e.items.forEach((e=>{const t=new b(e);s.append(t.getDOM()),this.#pe.push(t)}))}else{const e=document.createElement("div");this.#de.append(e)}this.#re=document.createElement("input"),this.#re.name=e.subcontentId,this.#re.classList.add("content-filter-item-checkbox"),this.#re.setAttribute("tabindex","-1"),this.#re.type="checkbox",this.#re.checked=!0,this.#de.append(this.#re);const s=document.createElement("span");s.classList.add("content-filter-item-label"),s.innerText=e.label,this.#de.append(s)}getDOM(){return this.#t}getName(){return this.#o.name}getSubcontentId(){return this.#o.subcontentId}getLevel(){return this.#o.level}getLabel(){return this.#o.label}getItems(){return this.#pe}isSelected(){return this.#re.checked}isExpandable(){return this.#he}isExpanded(){return this.#ce}isVisible(){return this.#j}toggleSelectedState(e){e=e??!this.#re.checked,this.#re.checked=e,this.#re.dispatchEvent(new Event("change",{bubbles:!0})),this.#t.setAttribute("aria-checked",e)}toggleTabbable(e){this.#t.setAttribute("tabindex",e?"0":"-1")}focus(){this.#t.focus()}toggleBorder(e,t){["top","bottom","left"].includes(e)&&"boolean"==typeof t&&this.#de.classList.toggle(`border-${e}`,t)}toggleExpandedState(e){this.#he&&(void 0===e&&(e=!this.#ce),this.#t.setAttribute("aria-expanded",e),this.#ce=e,this.#pe.forEach((t=>{t.toggleVisibility(e)})))}toggleVisibility(e){"boolean"==typeof e&&(this.#j=e,this.#pe.forEach((t=>{t.toggleVisibility(e&&this.isExpanded())})))}}class f{#t;#me;#ue;#ge;#pe=[];#r={};#be;constructor(e={},t={}){const s=(e,t=0)=>{e.level=t,e.items?.forEach((e=>{s(e,t+1)}))};s(e.item),this.#ge=e.l10n,this.#r=t??{},this.#r.onFilterChange=this.#r.onFilterChange??(()=>{}),this.#t=document.createElement("div"),this.#t.classList.add("content-filter"),this.#t.classList.add("block-visible");const a=document.createElement("div");a.classList.add("content-filter-header");const i=document.createElement("span");i.classList.add("content-filter-header-intro"),i.innerHTML=this.#ge.filterByContent,a.append(i),this.#me=document.createElement("span"),this.#me.classList.add("content-filter-header-selected"),this.#me.innerHTML=this.#ge.showAll,a.append(this.#me),this.#ue=document.createElement("button"),this.#ue.classList.add("button-reset"),this.#ue.classList.add("display-none"),this.#ue.textContent=this.#ge.reset,this.#ue.addEventListener("click",(()=>{this.#fe()})),a.append(this.#ue),this.#t.append(a);const n=document.createElement("ul");n.classList.add("content-filter-tree"),n.setAttribute("role","tree"),n.setAttribute("aria-multiselectable","true"),n.setAttribute("aria-label",this.#ge.contentFilter),this.#t.append(n);const l=new b(e.item);l.toggleVisibility(!0),n.append(l.getDOM()),this.#pe=this.flattenItems(l),this.#t.addEventListener("click",(e=>{this.#x(e)})),this.#t.addEventListener("change",(e=>{this.#xe(e)})),this.#t.addEventListener("keydown",(e=>{this.#ve(e)})),this.#be=this.#pe[0],this.#be.toggleTabbable(!0),this.#ye()}flattenItems(e,t=[]){return t.push(e),e.getItems().forEach((e=>{this.flattenItems(e,t)})),t}getDOM(){return this.#t}#x(e){if(e.target.classList.contains("content-filter-item-wrapper")||e.target.classList.contains("content-filter-item-checkbox"))return;const t=this.#pe.find((t=>t.getDOM()===e.target.closest(".content-filter-item")));t&&(t.toggleExpandedState(),this.#ye())}#xe(e){e.target.classList.contains("content-filter-item-checkbox")&&this.#Le()}#ve(e){if("Enter"!==e.code&&"Space"!==e.code||this.#be.toggleSelectedState(),"ArrowRight"===e.code){if(!this.#be.isExpandable())return;this.#be.isExpanded()?this.#Ee(this.#we()):this.#x(e)}else if("ArrowLeft"===e.code)this.#be.isExpandable()&&this.#be.isExpanded()?this.#x(e):this.#Ee(this.#ke());else if("ArrowDown"===e.key)this.#Ee(this.#we());else if("ArrowUp"===e.key)this.#Ee(this.#Se());else if("Home"===e.key)this.#Ee(this.#Ce()[0]);else if("End"===e.key)this.#Ee(this.#Ce().slice(-1)[0]);else if("*"===e.key){if(!this.#be.isExpandable())return;[...this.#be,...this.#Ie(this.#be)].filter((e=>e.isExpandable())).forEach((e=>{e.toggleExpandedState(!0)})),this.#ye()}else if(1===e.key.length&&e.key.match(/\S/)&&!e.ctrlKey&&!e.metaKey){const t=this.#Ce().indexOf(this.#be),s=this.#Ce().slice(t+1).find((t=>t.getLabel().toLowerCase().startsWith(e.key.toLowerCase())));s&&this.#Ee(s)}}#Le(){const e=this.#pe.filter((e=>e.isSelected()));let t;0===e.length?(t=this.#ge.showNone,this.#ue.classList.remove("display-none")):e.length===this.#pe.length?(t=this.#ge.showAll,this.#ue.classList.add("display-none")):(t=this.#ge.showSelected,this.#ue.classList.remove("display-none")),this.#me.innerHTML=t,this.#r.onFilterChange(e.map((e=>e.getSubcontentId())))}#fe(){this.#pe.forEach((e=>{e.toggleSelectedState(!0)})),this.#Le()}#Ee(e){e&&(this.#be.toggleTabbable(!1),this.#be=e,this.#be.toggleTabbable(!0),this.#be.focus())}#Ie(e){if(!e||!e.isVisible())return[];const t=this.#Ce(),s=t.indexOf(e),a=e.getLevel(),i=e=>{const t=[];for(const s of e){const e=s.getLevel();if(e===a)t.push(s);else if(e<a)break}return t};return[...i(t.slice(0,s).reverse()),...i(t.slice(s+1))]}#Ce(){return this.#pe.filter((e=>e.isVisible()))}#ke(){const e=this.#Ce();for(let t=e.indexOf(this.#be)-1;t>=0;t--)if(e[t].isExpandable())return e[t];return null}#Se(){const e=this.#Ce(),t=e.indexOf(this.#be);return-1===t||0===t?null:e[t-1]}#we(){const e=this.#Ce(),t=e.indexOf(this.#be);return-1===t||t===e.length-1?null:e[t+1]}#ye(){this.#Ce().forEach(((e,t,s)=>{e.toggleBorder("top",0===t||e.getLevel()<s[t-1].getLevel()),e.toggleBorder("bottom",t!==s.length-1&&e.getLevel()<=s[t+1].getLevel()),e.toggleBorder("left",0!==t)}))}}const x="locale",v={orDragTheFileHere:"or drag the file here",removeFile:"Remove file",selectYourLanguage:"Select your language",uploadProgress:"Upload progress",uploadYourH5Pfile:"Upload your H5P file",yourFileIsBeingChecked:"Your file is being checked",yourFileWasCheckedSuccessfully:"Your file check was completed",totalMessages:"Total messages",issues:"issues",results:"results",filterBy:"Filter by",groupBy:"Group by",download:"Download",expandAllMessages:"Expand all messages",collapseAllMessages:"Collapse all messages",allFilteredOut:"All messages have been filtered out by content.",reportTitleTemplate:"H5P Caretaker report for @title",contentFilter:"Content filter",showAll:"Show all",showSelected:"Various selected contents",showNone:"Show none",filterByContent:"Filter by content:",reset:"Reset",showDetails:"Show details",hideDetails:"Hide details",unknownError:"Something went wrong, but I dunno what, sorry!",checkServerLog:"Please check the server log."},y=200,L=300;window.H5PCaretaker=class{#d;#Me;#ee;#Te;#De;#Ae;#ge;#r={};constructor(e={},t={}){if(this.#ge={...v,...window.H5P_CARETAKER_L10N,...e.l10n},this.#Te=e.endpoint,this.#De=e.sessionKeyName,this.#Ae=e.sessionKeyValue,!this.#Te){const e=document.querySelector(".h5p-caretaker");this.#Te=e?.dataset.uploadEndpoint??"./upload"}this.#r=t,this.#r.onInitialized=this.#r.onInitialized??(()=>{}),this.#r.onUploadStarted=this.#r.onUploadStarted??(()=>{}),this.#r.onUploadEnded=this.#r.onUploadEnded??(()=>{}),this.#r.onReset=this.#r.onReset??(()=>{}),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",(()=>{this.#$e()})):this.#$e()}#$e(){const e=document.querySelector(".h5p-caretaker .select-language");e?.setAttribute("aria-label",v.selectYourLanguage),e?.addEventListener("change",(e=>{this.#Be(e)})),this.#d=new a({selectorDropzone:".h5p-caretaker .dropzone",...this.#De&&{sessionKeyName:this.#De},...this.#Ae&&{sessionKeyValue:this.#Ae},l10n:{orDragTheFileHere:this.#ge.orDragTheFileHere,removeFile:this.#ge.removeFile,uploadProgress:this.#ge.uploadProgress,uploadYourH5Pfile:this.#ge.uploadYourH5Pfile}},{upload:async e=>{this.#C(e)},reset:()=>{this.#fe()}}),window.setTimeout((()=>{this.#r.onInitialized()}),0)}async uploadByURL(e){if(this.#fe(),"string"==typeof e){e=encodeURI(e);try{const t=await fetch(e),s=await t.arrayBuffer(),a=new Uint8Array(s),i=e.split("/").pop(),n=new File([a],i,{type:"application/zip"}),l=new DataTransfer;l.items.add(n),this.#d.upload(l.files)}catch(e){this.#r.onUploadEnded(!1)}}else this.#r.onUploadEnded(!1)}#C(e={}){this.#r.onUploadStarted();const t=new FormData;t.append("file",e.file),e.session?.key&&e.session?.value&&t.append(e.session.key,e.session.value),t.append("sessionKeyName",this.#De),t.set("locale",document.querySelector(".select-language")?.value??"en"),this.#d.setStatus(""),this.#d.showProgress();const s=new XMLHttpRequest;if(s.open("POST",this.#Te,!0),s.upload.addEventListener("progress",(e=>{e.lengthComputable&&this.#Oe(e.loaded/e.total*100)})),s.addEventListener("load",(()=>{this.#ze(s),this.#r.onUploadEnded(!0)})),s.addEventListener("error",(()=>{this.#Re(s.statusText)})),e.signal&&(e.signal.addEventListener("abort",(()=>{s.abort(),this.#r.onUploadEnded(!1)})),e.signal.aborted))return s.abort(),void this.#r.onUploadEnded(!1);s.send(t)}#fe(){const e=new URLSearchParams(window.location.search);for(const t of e.keys())t!==x&&e.delete(t);window.history.replaceState({},document.title,`${window.location.pathname}?${e.toString()}${window.location.hash}`),document.querySelector(".filter-tree").innerHTML="",document.querySelector(".output").innerHTML="",this.#r.onReset()}#Be(e){const t=new URLSearchParams(window.location.search);t.set(e.target.dataset.localeKey??x,e.target.value),window.location.href=`${window.location.pathname}?${t.toString()}${window.location.hash}`}#Oe(e){this.#d.setProgress(e),100===e&&(this.#d.hideProgress(),this.#d.setStatus(this.#ge.yourFileIsBeingChecked,"pulse"))}#ze(e){this.#d.hideProgress();const t=e.status>=y&&e.status<L;let s,a;if([s,a]=this.parseResponse(e),!t||a)return void this.#Re(a);this.#ge={...this.#ge,...s.client.translations},this.#d.setStatus(this.#ge.yourFileWasCheckedSuccessfully);const i=e=>{const t={label:e.label,subcontentId:e.subContentId};return Array.isArray(e.children)&&(t.items=e.children.map((e=>i(e)))),t},n=new f({item:i(s.contentTree),l10n:{contentFilter:this.#ge.contentFilter,showAll:this.#ge.showAll,showSelected:this.#ge.showSelected,showNone:this.#ge.showNone,filterByContent:this.#ge.filterByContent,reset:this.#ge.reset}},{onFilterChange:e=>{const t=this.#Ve(s.messages.filter((t=>e.includes(t.subContentId))));this.#Me.update(t),this.#ee.filter(e)}});document.querySelector(".filter-tree").append(n.getDOM()),s.messages=s.messages.map((e=>{e.issues=("error"===e.level||"caution"===e.level)&&"issues";const t=e.details?.path;return t&&t.startsWith("images/")?(e.details?.path&&e.details?.path.startsWith("images/")&&(e.details.base64=s.raw.media.images[t.split("/").pop()]?.base64),e):e})),this.#Me=new r({results:this.#Ve(s.messages),l10n:{results:this.#ge.results,filterBy:this.#ge.filterBy,groupBy:this.#ge.groupBy,download:this.#ge.download}},{onResultsTypeChanged:e=>{this.#ee.show(e)},onDownload:()=>{const e=this.#ge.reportTitleTemplate.replace("@title",`${s.raw.h5pJson.title} (${s.raw.h5pJson.mainLibrary})`);new g({title:e,messages:s.messages,l10n:this.#ge,translations:s.client.translations}).download()}}),document.querySelector(".output").append(this.#Me.getDOM());const l=[...new Set(s.messages.map((e=>e.category)))];this.#ee=new u({sets:{level:["error","caution","info"],category:l,issues:[{id:"issues",header:this.#ge.issues}]},messages:s.messages,translations:s.client.translations,l10n:{expandAllMessages:this.#ge.expandAllMessages,collapseAllMessages:this.#ge.collapseAllMessages,allFilteredOut:this.#ge.allFilteredOut,showDetails:this.#ge.showDetails,hideDetails:this.#ge.hideDetails}}),document.querySelector(".output").append(this.#ee.getDOM())}parseResponse(e){let t,s=null;try{t=JSON.parse(e.responseText)}catch(a){t=!1,s=this.#Pe(e.responseText)}return t.error&&(s=t.error),[t,s]}#Pe(e){return!e||((e="")=>/<\/?[^>]+(>|$)/.test(e))(e)?`${this.#ge.unknownError} ${this.#ge.checkServerLog}`:e}#Ve(e){const s=[{id:"error",value:e.filter((e=>"error"===e.level)).length,max:e.length,label:t(this.#ge.error),link:"#error",color:"var(--color-error)",percentage:!1},{id:"caution",value:e.filter((e=>"caution"===e.level)).length,max:e.length,label:t(this.#ge.caution),link:"#caution",color:"var(--color-caution)",percentage:!1},{id:"info",value:e.filter((e=>"info"===e.level)).length,max:e.length,label:t(this.#ge.info),link:"#info",color:"var(--color-info)",percentage:!1}],a=[...new Set(e.map((e=>e.category)))].map((s=>({id:s,value:e.filter((e=>e.category===s)).length,max:e.length,label:t(this.#ge[s]),link:`#${s}`,color:"var(--color-primary)",percentage:!1}))),i=[{id:"issues",value:e.filter((e=>e.issues)).length,max:e.length,label:t(this.#ge.issues),link:"#issues",color:"status",percentage:!1}];return{level:{label:this.#ge.level,header:this.#ge.totalMessages,value:e.length,items:s,type:"group"},category:{label:this.#ge.category,header:this.#ge.totalMessages,value:e.length,items:a,type:"group"},issues:{label:this.#ge.issues,header:this.#ge.totalMessages,value:e.length,items:i,type:"filter"}}}#Re(e){this.#d.setStatus(e,"error"),this.#r.onUploadEnded(!1)}}})();