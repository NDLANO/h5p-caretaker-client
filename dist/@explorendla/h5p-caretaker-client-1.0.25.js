(()=>{"use strict";const e=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(e=>{const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})),t=e=>"string"!=typeof e?"":`${e[0].toUpperCase()}${e.slice(1)}`;class s{#e=0;#t;#s;#a;#i;constructor(e={}){this.#t=document.createElement("div"),this.#t.classList.add("progressbar-wrapper"),this.#s=document.createElement("div"),this.#s.setAttribute("role","progressbar"),this.#s.setAttribute("aria-label",e.l10n.uploadProgress),this.#s.classList.add("progressbar-background"),this.#t.appendChild(this.#s),this.#a=document.createElement("div"),this.#a.classList.add("progressbar-fill"),this.#s.appendChild(this.#a),this.#i=document.createElement("span"),this.#i.classList.add("progress-value"),this.#t.appendChild(this.#i),this.setProgress(0)}getDOM(){return this.#t}show(){this.#t.classList.remove("display-none")}hide(){this.#t.classList.add("display-none")}setProgress(e){"number"==typeof e&&(e=Math.max(0,Math.min(e,100)),this.#e=e,this.#t.setAttribute("aria-valuenow",this.#e),this.#a.style.width=`${this.#e}%`,this.#i.innerText=`${Math.floor(this.#e)}%`)}getProgress(){return this.#e}}class a{#n=!1;#l=null;#o;#r;#d;#c;#h;#p;#m;#u;#g;#b;constructor(e={},t={}){this.#o=e,this.#o.selectorDropzone&&(this.#r=t??{},this.#r.upload=this.#r.upload??(()=>{}),this.#r.reset=this.#r.reset??(()=>{}),this.#f())}#f(){if(this.#d=document.querySelector(this.#o.selectorDropzone),!this.#d)return;if(this.#d.innerHTML="",this.#d.addEventListener("click",(e=>{this.#v(e)})),this.#d.addEventListener("dragover",(e=>{this.#y(e)})),this.#d.addEventListener("dragleave",(()=>{this.#x()})),this.#d.addEventListener("drop",(e=>{this.#L(e)})),this.#h=document.createElement("div"),this.#h.classList.add("upload-wrapper"),this.#o.sessionKeyName&&this.#o.sessionKeyValue){const e=document.createElement("input");e.type="hidden",e.name=this.#o.sessionKeyName,e.value=this.#o.sessionKeyValue,this.#h.append(e)}this.#p=document.createElement("input"),this.#p.classList.add("file-input"),this.#p.id="file-input",this.#p.type="file",this.#p.accept=".h5p",this.#p.addEventListener("change",(e=>{this.#E(e)})),this.#h.append(this.#p);const e=document.createElement("label");e.classList.add("upload-button"),e.htmlFor="file-input",e.innerText=this.#o.l10n.uploadYourH5Pfile,this.#h.append(e),this.#d.append(this.#h),this.#m=document.createElement("div"),this.#m.classList.add("file-info"),this.#m.classList.add("display-none");const t=document.createElement("div");t.classList.add("file-data"),this.#m.append(t),this.#u=document.createElement("div"),this.#u.classList.add("file-name"),t.append(this.#u),this.#g=document.createElement("div"),this.#g.classList.add("file-value"),t.append(this.#g);const a=document.createElement("button");a.classList.add("remove-button"),a.setAttribute("aria-label",this.#o.l10n.removeFile),a.addEventListener("click",(()=>{this.reset()})),this.#m.append(a),this.#d.append(this.#m),this.#b=new s({l10n:{uploadProgress:this.#o.l10n.uploadProgress}}),this.hideProgress(),this.#d.append(this.#b.getDOM()),this.#c=document.createElement("p"),this.#c.classList.add("status"),this.#c.innerText=this.#o.l10n.orDragTheFileHere,this.#d.append(this.#c)}#w(e={}){e.name&&(this.#k(),this.#u.innerText=e.name,e.size&&(this.#g.innerText=`${(e.size/1024).toFixed(2)} KB`),this.#h.classList.add("display-none"),this.#m.classList.remove("display-none"))}#I(){this.#n=!1,this.#d.removeAttribute("disabled")}#k(){this.#n=!0,this.#d.setAttribute("disabled","disabled")}reset(){this.#l&&(this.#l.abort(),this.#l=null),this.#m.classList.add("display-none"),this.#h.classList.remove("display-none"),this.setStatus(this.#o.l10n.orDragTheFileHere),this.hideProgress(),this.#I(),this.#r.reset()}setStatus(e="",t=""){this.#c.classList.toggle("display-none",!e),this.#c.classList.toggle("error","error"===t),this.#c.classList.toggle("pulse","pulse"===t),this.#c.innerText=e}showProgress(){this.#b.show()}hideProgress(){this.#b.hide()}setProgress(e){this.#b.setProgress(e)}#v(e){this.#n||e.target===this.#d&&(this.#p.click(),this.#d.classList.add("active"))}#y(e){e?.preventDefault(),this.#d.classList.add("dragging")}#x(){this.#d.classList.remove("dragging")}#L(e){e.preventDefault(),e?.dataTransfer.files.length&&(this.#d.classList.remove("dragging"),this.upload(e.dataTransfer.files))}#E(e){this.#S(e.target.files[0])}upload(e){this.#p.files=e,this.#S(this.#p.files[0])}#S(e){if(!e)return;this.#w(e),this.#p.value="",this.#d.classList.remove("active"),this.#l=new AbortController;const t={file:e,signal:this.#l.signal};this.#o.sessionKeyName&&this.#o.sessionKeyValue&&(t.session={key:this.#o.sessionKeyName,value:this.#o.sessionKeyValue}),this.#r.upload(t)}}const i=100,n={5:"good",10:"neutral",100:"bad"};class l{#t;#C;#A;#o;constructor(e={}){this.#o=e,"number"==typeof e.size&&(e.size=`${e.size}px`),this.#o.size=e.size??"5rem",this.#o.strokeWidth=e.strokeWidth??"0.5rem",this.#o.max=e.max??i,this.#t=document.createElement("div"),this.#t.classList.add("progress-circle-container"),this.#t.style.setProperty("--size",this.#o.size),this.#t.style.setProperty("--stroke-width",this.#o.strokeWidth);const t=document.createElement("div");t.classList.add("progress-circle-wrapper"),this.#t.append(t);const s=document.createElementNS("http://www.w3.org/2000/svg","svg");s.classList.add("progress-circle"),s.setAttribute("width","100%"),s.setAttribute("height","100%"),t.append(s);const a=document.createElementNS("http://www.w3.org/2000/svg","circle");a.setAttribute("class","progress-circle-background"),s.append(a);const n=document.createElementNS("http://www.w3.org/2000/svg","circle");n.setAttribute("class","progress-circle-foreground"),s.append(n),this.setColor(this.#o.color),this.#C=document.createElement("span"),this.#C.classList.add("progress-circle-value"),this.setValue(this.#o.value,this.#o.max,this.#o.percentage),t.append(this.#C),this.#A=document.createElement("span"),this.#A.classList.add("progress-circle-label"),this.setLabel(this.#o.label,this.#o.link),this.#t.append(this.#A)}getDOM(){return this.#t}setValue(e,t=100,s=!0){"number"==typeof e&&(("number"!=typeof t||t<0)&&(t=i),"boolean"!=typeof s&&(s=!0),e=Math.max(0,Math.min(t,e)),s&&(e=e/t*i),e=Math.round(e),this.#o.value=e,s?this.#t.style.setProperty("--progress",e):this.#t.style.setProperty("--progress",e/t*i),this.#t.classList.toggle("empty",0===e),this.#C.innerText=s?`${e}%`:`${e}`,0===e?this.setColor("transparent"):this.setColor(this.#o.color))}setLabel(e,t){"string"==typeof e&&("string"!=typeof t?this.#A.innerText=e:this.#A.innerHTML=`<a href="${t}">${e}</a>`)}setColor(e){if("string"==typeof e&&(this.#t.style.setProperty("--stroke-color",e),"transparent"!==e&&"status"!==e&&(this.#o.color=e),"status"===e)){const e=this.#o.value/this.#o.max*i;for(const t in n)if(e<=t){this.#t.style.setProperty("--stroke-color",`var(--color-status-${n[t]})`);break}}}}class o{#t;#T;#$={};constructor(e={}){this.#t=document.createElement("div"),this.#t.classList.add("results-row");const t=document.createElement("div");t.classList.add("overview"),this.#t.append(t);const s=document.createElement("div");s.classList.add("overview-header"),s.textContent=e.header,t.append(s),this.#T=document.createElement("div"),this.#T.classList.add("overview-value"),this.#T.textContent=e.value,t.append(this.#T);const a=document.createElement("div");a.classList.add("progress-circles"),this.#t.append(a),e.items.forEach((e=>{const t=new l({id:e.id,value:e.value,max:e.max,percentage:e.percentage,label:e.label,link:e.link,color:e.color});a.append(t.getDOM()),this.#$[e.id]=t}))}getDOM(){return this.#t}update(e={}){"number"==typeof e.messageCount&&e.items&&(this.#T.textContent=e.messageCount,Object.keys(this.#$).forEach((t=>{const s=e.items.find((e=>e.id===t));s?this.#$[t].setValue(s.value,s.max,s.percentage):this.#$[t].setValue(0,e.messageCount,!1)})))}}class r{#t;#M;#o;#r;#D;constructor(e={},t={}){this.#o=e,this.#r=t,this.#r.onResultsTypeChanged=this.#r.onResultsTypeChanged??(()=>{}),this.#r.onDownload=this.#r.onDownload??(()=>{}),this.#D=this.#O(this.#o.results),this.#t=document.createElement("div"),this.#t.classList.add("results"),this.#t.classList.add("block-visible");const s=document.createElement("div");s.classList.add("results-header"),s.textContent=e.l10n.results,this.#t.append(s),this.#M=document.createElement("div"),this.#M.classList.add("results-box"),this.#t.append(this.#M),this.#M.append(this.#D[Object.keys(this.#o.results)[0]].getDOM()),this.#M.append(this.#P())}getDOM(){return this.#t}update(e){for(const t in e)this.#D[t].update({messageCount:e[t].value,items:e[t].items})}#O(e){const t={};for(const s in e)t[s]=new o(e[s]);return t}#P(){const e=document.createElement("div");e.classList.add("navigation-row");const s=document.createElement("select");s.name="select-results-type",s.setAttribute("aria-label",this.#o.l10n.changeSortingGrouping),s.classList.add("select-results-type"),s.addEventListener("change",(e=>{this.#z(e)})),e.append(s);for(const e in this.#o.results){const a=document.createElement("option");a.value=e;const i=this.#o.results[e].type,n=t(this.#o.results[e].label??e);a.textContent="filter"===i?`${this.#o.l10n.filterBy}: ${n}`:"group"===i?`${this.#o.l10n.groupBy}: ${n}`:n,s.append(a)}const a=document.createElement("button");return a.classList.add("button-download"),a.textContent=this.#o.l10n.download,a.addEventListener("click",(()=>{this.#r.onDownload()})),e.append(a),e}#z(e){this.#M.querySelector(".results-row").remove(),this.#M.prepend(this.#D[e.target.value].getDOM()),this.#r.onResultsTypeChanged(e.target.value)}}class d{#t;#V;#o;#B;#R;constructor(e={}){if(this.#t=document.createElement("div"),this.#t.classList.add("message-content"),this.#V=e.message.subContentId??e.message.details?.subContentId,this.#o=JSON.parse(JSON.stringify(e)),this.#o.message.description){const e=document.createElement("div");e.classList.add("message-content-item");const t=document.createElement("p");t.classList.add("message-content-item-label"),t.innerText=this.#o.translations.description,e.append(t);const s=document.createElement("p");s.classList.add("message-content-item-text"),s.innerText=this.#o.message.description,e.append(s),this.#t.append(e)}if(this.#o.message.category){const e=document.createElement("div");e.classList.add("message-content-item");const t=document.createElement("p");t.classList.add("message-content-item-label"),t.innerText=this.#o.translations.category,e.append(t);const s=document.createElement("p");s.classList.add("message-content-item-text");let a=this.#o.translations[this.#o.message.category];this.#o.message.type&&(a=`${a} > ${this.#o.translations[this.#o.message.type]}`),s.innerText=a,e.append(s),this.#t.append(e)}if(this.#o.message.recommendation){const e=document.createElement("div");e.classList.add("message-content-item");const t=document.createElement("p");t.classList.add("message-content-item-label"),t.innerText=this.#o.translations.recommendation,e.append(t);const s=document.createElement("p");s.classList.add("message-content-item-text"),s.innerText=this.#o.message.recommendation,e.append(s),this.#t.append(e)}if("libreText"===this.#o.message.type){const e=`<h3>${this.#o.translations.status}</h3><p>${this.#o.message.details.status}</p>`;this.#o.message.details.description=`${this.#o.message.details.description}${e}`;const t=`<h3>${this.#o.translations.licenseNote}</h3><p>${this.#o.message.details.licenseNote}</p>`;this.#o.message.details.description=`${this.#o.message.details.description}${t}`;this.#F(this.#o.message.details.description).forEach((e=>{const t=document.createElement("div");t.classList.add("message-content-item");const s=document.createElement("p");s.classList.add("message-content-item-label"),s.innerText=e.headline,t.append(s);const a=document.createElement("div");a.classList.add("message-content-details"),a.innerHTML=e.html,t.append(a),this.#t.append(t)}))}if(this.#o.message.details?.base64){const e=document.createElement("div");e.classList.add("message-content-item");const t=document.createElement("p");t.classList.add("message-content-item-label"),t.innerText=this.#o.translations.image,e.append(t);const s=document.createElement("img");s.classList.add("message-content-image"),s.src=this.#o.message.details.base64,e.append(s),this.#t.append(e)}if("libreText"!==this.#o.message.type&&this.#o.message.details){const e=document.createElement("div");e.classList.add("message-content-item"),this.#B=document.createElement("button"),this.#B.classList.add("message-content-details-button"),this.#B.addEventListener("click",(e=>{this.#N(e)})),e.append(this.#B),this.#R=document.createElement("ul"),this.#R.classList.add("message-content-details"),this.#R.classList.add("display-none"),Object.keys(this.#o.message.details).forEach((e=>{if("reference"===e||"base64"===e)return;const t=document.createElement("li");t.classList.add("message-content-detail"),t.innerText=`${e}: ${this.#o.message.details[e]}`,this.#R.append(t)})),e.append(this.#R),this.#U(!1),this.#t.append(e)}if(this.#o.message.details?.reference){const e=document.createElement("a");e.classList.add("message-content-reference"),e.href=this.#o.message.details.reference,e.target="_blank",e.innerText=this.#o.translations.learnMore,this.#t.append(e)}}getDOM(){return this.#t}getSubContentId(){return this.#V}#N(e){e.stopPropagation(),this.#U()}#U(e){e=!this.#R.classList.toggle("display-none","boolean"==typeof e?!e:void 0),this.#B.innerText=e?this.#o.l10n.hideDetails:this.#o.l10n.showDetails}#F(e){const t=(new DOMParser).parseFromString(e,"text/html").querySelectorAll("h2, h3, h4, h5, h6"),s=[];return t.forEach(((e,t)=>{const a=e.textContent.trim();let i="",n=e.nextElementSibling;for(;n&&!n.matches("h2, h3, h4, h5, h6");)i+=n.outerHTML,n=n.nextElementSibling;s.push({headline:a,html:i.trim()})})),s}}class c{#t;#K;#H=!0;constructor(e={}){this.#t=document.createElement("div"),this.#t.classList.add("carousel-item"),this.#t.setAttribute("role","group"),this.#t.setAttribute("aria-roledescription","slide"),this.#t.setAttribute("aria-labelledby",`carousel-item-summary-${e.carouselUuid}-${e.index}`);const t=document.createElement("div");t.classList.add("carousel-item-header"),this.#t.append(t);const s=document.createElement("span");s.setAttribute("id",`carousel-item-summary-${e.carouselUuid}-${e.index}`),s.classList.add("summary"),s.innerText=e.message.summary,t.append(s);const a=document.createElement("span");a.classList.add("level"),a.classList.add(e.message.level),a.innerText=e.message.level,t.append(a),this.#K=new d({message:e.message,translations:e.translations,l10n:e.l10n}),this.#t.append(this.#K.getDOM())}getDOM(){return this.#t}getSubContentId(){return this.#K.getSubContentId()}toggleActive(e){this.#t.classList.toggle("active",e)}toggleAvailable(e){this.#H=e}isAvailable(){return this.#H}}class h{#t;#W=0;#T;#G=[];constructor(t={}){const s=e();this.#t=document.createElement("section"),this.#t.setAttribute("id",`carousel-${s}`),this.#t.classList.add("h5p-caretaker-carousel"),this.#t.setAttribute("aria-roledescription","carousel"),this.#t.setAttribute("aria-label",t.ariaLabel);const a=document.createElement("div");a.classList.add("carousel-controls"),this.#t.append(a);const i=document.createElement("button");i.classList.add("carousel-button"),i.classList.add("previous"),i.setAttribute("aria-label",t.l10n.previousMessage),i.setAttribute("aria-controls",`carousel-items-${s}`),i.addEventListener("click",(e=>{e.stopPropagation(),this.#q(this.#W-1)})),a.append(i),this.#T=document.createElement("span"),this.#T.classList.add("carousel-count"),this.#T.setAttribute("aria-live","polite"),this.#T.style.setProperty("--count-width",2*t.messages.length.toString().length+3+"ch"),a.append(this.#T);const n=document.createElement("button");n.classList.add("carousel-button"),n.classList.add("next"),n.setAttribute("aria-label",t.l10n.nextMessage),n.setAttribute("aria-controls",`carousel-items-${s}`),n.addEventListener("click",(e=>{e.stopPropagation(),this.#q(this.#W+1)})),a.append(n);const l=document.createElement("div");l.setAttribute("id",`carousel-items-${s}`),l.classList.add("carousel-items"),this.#t.append(l),t.messages.forEach(((e,a)=>{const i=new c({message:e,index:a,carouselUuid:s,translations:t.translations,l10n:t.l10n});this.#G.push(i),l.append(i.getDOM())})),this.#q(0)}getDOM(){return this.#t}getSubContentIds(){return this.#G.map((e=>e.getSubContentId()))}getNumberOfAvailableItems(){return this.#G.filter((e=>e.isAvailable())).length}filter(e){this.#G.forEach((t=>{t.toggleAvailable(e.includes(t.getSubContentId()))})),this.#q(this.#W)}#q(e){if("number"!=typeof e)return;const t=-1===this.#W||e===this.#W?0:Math.sign(e-this.#W);e=(e%this.#G.length+this.#G.length)%this.#G.length,this.#G[e].isAvailable()||(e=this.#Y(e,t)),this.#G.forEach(((t,s)=>{t.toggleActive(s===e)})),this.#W=e,this.#J()}#Y(e,t){t=0===t?1:t;const s=this.#G.map((e=>e.isAvailable()));if(1===t){const t=s.indexOf(!0,e);return-1!==t?t:s.indexOf(!0)}{const t=s.lastIndexOf(!0,e);return-1!==t?t:s.lastIndexOf(!0)}}#J(){const e=this.#G.filter((e=>e.isAvailable())).findIndex((e=>e===this.#G[this.#W]));this.#T.innerText=`${e+1} / ${this.getNumberOfAvailableItems()}`}}class p{#t;#j;#_;#X;#T;#Q=!0;#r;constructor(t={},s={}){this.#r=s,this.#r.expandedStateChanged=this.#r.expandedStateChanged??(()=>{}),this.#t=document.createElement("div"),this.#t.classList.add("type-accordion-panel");const a=`var(--type-accordion-panel-header-icon-${t.type}, var(--type-accordion-header-icon))`;this.#t.style.setProperty("--type-accordion-panel-header-icon",a);const i=e(),n=e(),l=document.createElement("div");l.classList.add("type-accordion-panel-header"),l.setAttribute("id",i),this.#_=document.createElement("button"),this.#_.classList.add("type-accordion-panel-button"),this.#_.setAttribute("aria-expanded","false"),this.#_.setAttribute("aria-controls",n),this.#_.innerText=t.translations[t.type],l.append(this.#_),this.#T=document.createElement("span"),this.#T.classList.add("type-accordion-panel-count"),l.append(this.#T);const o=document.createElement("span");o.classList.add("type-accordion-panel-icon"),l.append(o),this.#t.append(l),this.#j=document.createElement("div"),this.#j.setAttribute("id",n),this.#j.classList.add("type-accordion-panel-content-grid"),this.#j.setAttribute("role","region"),this.#j.setAttribute("aria-labelledby",i),this.#j.setAttribute("hidden","");const r=document.createElement("div");r.classList.add("type-accordion-panel-content-wrapper"),this.#X=new h({ariaLabel:t.translations[t.type],messages:t.messages,translations:t.translations,l10n:t.l10n}),r.append(this.#X.getDOM()),this.#j.append(r),this.#t.append(this.#j),this.#t.addEventListener("click",(()=>{this.toggle()})),this.updateMessageCount()}getDOM(){return this.#t}isVisible(){return this.#Q}isExpanded(){return"true"===this.#_.getAttribute("aria-expanded")}toggle(e){("boolean"==typeof e?e:"true"!==this.#_.getAttribute("aria-expanded"))?this.expand():this.collapse()}filter(e){this.#X.filter(e),this.updateMessageCount(),!e||this.#X.getNumberOfAvailableItems()>0?this.show():(this.collapse(),this.hide())}updateMessageCount(){this.#T.innerText=this.#X.getNumberOfAvailableItems()}show(){this.#t.classList.remove("display-none"),this.#Q=!0}hide(){this.#t.classList.add("display-none"),this.#Q=!1}expand(){this.#j.removeAttribute("hidden"),this.#_.setAttribute("aria-expanded","true"),this.#r.expandedStateChanged(!0)}collapse(){this.#j.setAttribute("hidden",""),this.#_.setAttribute("aria-expanded","false"),this.#r.expandedStateChanged(!1)}}class m{#t;#Z;#ee=[];constructor(e={}){this.#t=document.createElement("div"),this.#t.classList.add("type-accordion"),this.#t.style.setProperty("--type-accordion-header-icon",`var(--type-accordion-header-icon-${e.type})`);const t=document.createElement("a");t.classList.add("type-accordion-header-anchor"),t.setAttribute("name",`${e.type}`),this.#t.append(t);const s=document.createElement("div");s.classList.add("type-accordion-header"),this.#t.append(s);const a=document.createElement("p");a.classList.add("type-accordion-header-text"),a.innerText=e.header,s.append(a);const i=document.createElement("ul");i.classList.add("type-accordion-panels-list"),this.#t.append(i);[...new Set(e.messages.map((e=>e.type)))].forEach((t=>{const s=document.createElement("li");s.classList.add("type-accordion-panels-list-item");const a=new p({type:t,messages:e.messages.filter((e=>e.type===t)),translations:e.translations,l10n:{nextMessage:e.l10n.nextMessage,previousMessage:e.l10n.previousMessage,showDetails:e.l10n.showDetails,hideDetails:e.l10n.hideDetails}});this.#ee.push(a),s.append(a.getDOM()),i.append(s)})),this.#Z=document.createElement("div"),this.#Z.classList.add("type-accordion-all-filtered"),this.#Z.classList.add("display-none"),this.#Z.innerHTML=e.l10n.allFilteredOut,this.#t.append(this.#Z)}getDOM(){return this.#t}filter(e){this.#ee.forEach((t=>{t.filter(e)})),this.#ee.some((e=>e.isVisible()))?this.#Z.classList.add("display-none"):this.#Z.classList.remove("display-none")}}class u{#t;#te=[];constructor(e={}){this.#t=document.createElement("div"),this.#t.classList.add("message-set"),e.sections.forEach((t=>{const s=e.messages.filter((s=>s[e.id]===t.id));if(!s.length)return;const a=new m({type:t.id,header:t.header,messages:s,translations:e.translations,l10n:e.l10n});this.#te.push(a),this.#t.append(a.getDOM())}))}getDOM(){return this.#t}filter(e){this.#te.forEach((t=>{t.filter(e)}))}show(){this.#t.classList.remove("display-none")}hide(){this.#t.classList.add("display-none")}}class g{#t;#se;constructor(e={}){this.#t=document.createElement("div"),this.#t.classList.add("message-sets"),this.#se={};for(const t in e.sets)e.sets[t]=e.sets[t].filter((e=>"string"==typeof e||"string"==typeof e?.id)).map((t=>("string"==typeof t&&(t={id:t}),t.header=t.header??e.translations[t.id],t))),e.sets[t].length||delete e.sets[t];if(0!==Object.keys(e.sets).length){for(const t in e.sets)this.#se[t]=new u({id:t,sections:e.sets[t],messages:e.messages,translations:e.translations,l10n:e.l10n}),this.#t.append(this.#se[t].getDOM());this.show(Object.keys(this.#se)[0])}}getDOM(){return this.#t}show(e){if(this.#se[e])for(const t in this.#se)t===e?this.#se[t].show():this.#se[t].hide()}filter(e){for(const t in this.#se)this.#se[t].filter(e)}}class b{#ae;#ie;#ne;constructor(e={}){this.#ae=e.messages,this.#ie=e.translations,this.#ne=e.title}get(e={}){return e.type=e.type??"markdown","markdown"===e.type?this.#le():""}download(e={}){e.type=e.type??"markdown";const t=document.createElement("a");if("markdown"===e.type){if(t.href=`data:text/plain;charset=utf-8,${encodeURIComponent(this.#le())}`,"string"==typeof e.filename&&e.filename.length>0)t.download=e.filename;else{const e=(new Date).toISOString().split(".")[0].replace(/[-T:]/g,"");t.download=`h5p-caretaker-report-${e}.txt`}t.style.display="none",document.body.append(t),t.click(),t.remove()}}#le(){let e=`# ${this.#ne}\n\n`;const s=["error","caution","info"].filter((e=>this.#ae.some((t=>t.level===e)))).map((e=>({headline:t(this.#ie[e]),messages:this.#ae.filter((t=>t.level===e))}))).reduce(((e,t)=>`${e}${`## ${t.headline}\n\n`}${t.messages.map((e=>this.#oe(e))).join("\n")}\n\n`),"");return`${e}${s}`}#oe(e){let s=`### ${e.summary}\n\n`;if(e.description){s=`${s}${`#### ${t(this.#ie.description)}\n${e.description}\n`}\n`}if(s=`${s}${`#### ${t(this.#ie.category)}\n${this.#ie[e.category]} > ${this.#ie[e.type]}\n`}\n`,e.recommendation){s=`${s}${`#### ${t(this.#ie.recommendation)}\n${e.recommendation}\n`}\n`}if(e.details){let a=`#### ${t(this.#ie.details)}\n`;for(const t in e.details)"base64"!==t&&(a="libreText"!==e.type||"description"!==t?`${a}* ${t}: ${e.details[t]}\n`:`${a}* ${this.#ie[t]}: ${this.#re(e.details[t])}\n`);s=`${s}${a}`}return s}#re(e){e=e.replace(/<\/h[1-6]>/g,": ").replace(/<\/li>\n*<\/ul>/g," ").replace(/<\/li>/g,", ").replace(/\r?\n|\r/g," ");const t=document.createElement("div");return t.innerHTML=e,(t.textContent||t.innerText||"").replace(/\s+/g," ")}}class f{#t;#de;#ce;#he;#pe=!1;#me=!1;#Q=!1;#ue=[];#o;constructor(t={}){this.#o=t;const s=e();this.#t=document.createElement("li"),this.#t.classList.add("content-filter-item"),this.#t.setAttribute("role","treeitem"),this.#t.setAttribute("tabindex","-1"),this.#t.setAttribute("aria-checked","true");const a=document.createElement("div");if(a.classList.add("content-filter-item-wrapper"),this.#t.append(a),this.#he=document.createElement("div"),this.#he.classList.add("content-filter-item-panel"),a.append(this.#he),this.#me=t.items?.length>0,this.#me){this.#he.classList.add("expandable"),this.#de=document.createElement("button"),this.#de.classList.add("content-filter-item-expander"),this.#de.setAttribute("tabindex","-1"),this.#he.append(this.#de),this.#t.setAttribute("aria-expanded",this.#pe);const e=document.createElement("ul");e.classList.add("content-filter-group"),e.setAttribute("role","group"),a.append(e),t.items.forEach((s=>{const a=new f({...s,l10n:t.l10n});e.append(a.getDOM()),this.#ue.push(a)})),this.toggleExpandedState(!1)}else{const e=document.createElement("div");this.#he.append(e)}this.#ce=document.createElement("input"),this.#ce.name=t.subcontentId,this.#ce.classList.add("content-filter-item-checkbox"),this.#ce.setAttribute("aria-labelledby",s),this.#ce.setAttribute("tabindex","-1"),this.#ce.type="checkbox",this.#ce.checked=!0,this.#he.append(this.#ce);const i=document.createElement("span");i.setAttribute("id",s),i.classList.add("content-filter-item-label"),i.innerText=t.label,this.#he.append(i)}getDOM(){return this.#t}getName(){return this.#o.name}getSubcontentId(){return this.#o.subcontentId}getLevel(){return this.#o.level}getLabel(){return this.#o.label}getItems(){return this.#ue}isSelected(){return this.#ce.checked}isExpandable(){return this.#me}isExpanded(){return this.#pe}isVisible(){return this.#Q}toggleSelectedState(e){e=e??!this.#ce.checked,this.#ce.checked=e,this.#ce.dispatchEvent(new Event("change",{bubbles:!0})),this.#t.setAttribute("aria-checked",e)}toggleTabbable(e){this.#t.setAttribute("tabindex",e?"0":"-1")}focus(){this.#t.focus()}toggleBorder(e,t){["top","bottom","left"].includes(e)&&"boolean"==typeof t&&this.#he.classList.toggle(`border-${e}`,t)}toggleExpandedState(e){this.#me&&(void 0===e&&(e=!this.#pe),this.#t.setAttribute("aria-expanded",e),this.#pe=e,e?this.#de.setAttribute("aria-label",this.#o.l10n.collapseList):this.#de.setAttribute("aria-label",this.#o.l10n.expandList),this.#ue.forEach((t=>{t.toggleVisibility(e)})))}toggleVisibility(e){"boolean"==typeof e&&(this.#Q=e,this.#ue.forEach((t=>{t.toggleVisibility(e&&this.isExpanded())})))}}class v{#t;#ge;#be;#fe;#ue=[];#r={};#ve;constructor(e={},t={}){const s=(e,t=0)=>{e.level=t,e.items?.forEach((e=>{s(e,t+1)}))};s(e.item),this.#fe=e.l10n,this.#r=t??{},this.#r.onFilterChange=this.#r.onFilterChange??(()=>{}),this.#t=document.createElement("div"),this.#t.classList.add("content-filter"),this.#t.classList.add("block-visible");const a=document.createElement("div");a.classList.add("content-filter-header");const i=document.createElement("span");i.classList.add("content-filter-header-intro"),i.innerHTML=this.#fe.filterByContent,a.append(i),this.#ge=document.createElement("span"),this.#ge.classList.add("content-filter-header-selected"),this.#ge.innerHTML=this.#fe.showAll,a.append(this.#ge),this.#be=document.createElement("button"),this.#be.classList.add("button-reset"),this.#be.classList.add("display-none"),this.#be.textContent=this.#fe.reset,this.#be.addEventListener("click",(()=>{this.#ye()})),a.append(this.#be),this.#t.append(a);const n=document.createElement("ul");n.classList.add("content-filter-tree"),n.setAttribute("role","tree"),n.setAttribute("aria-multiselectable","true"),n.setAttribute("aria-label",this.#fe.contentFilter),this.#t.append(n);const l=new f({...e.item,l10n:{expandList:e.l10n.expandList,collapseList:e.l10n.collapseList}});l.toggleVisibility(!0),n.append(l.getDOM()),this.#ue=this.flattenItems(l),this.#t.addEventListener("click",(e=>{this.#v(e)})),this.#t.addEventListener("change",(e=>{this.#xe(e)})),this.#t.addEventListener("keydown",(e=>{this.#Le(e)})),this.#ve=this.#ue[0],this.#ve.toggleTabbable(!0),this.#Ee()}flattenItems(e,t=[]){return t.push(e),e.getItems().forEach((e=>{this.flattenItems(e,t)})),t}getDOM(){return this.#t}#v(e){if(e.target.classList.contains("content-filter-item-wrapper")||e.target.classList.contains("content-filter-item-checkbox"))return;const t=this.#ue.find((t=>t.getDOM()===e.target.closest(".content-filter-item")));t&&(t.toggleExpandedState(),this.#Ee())}#xe(e){e.target.classList.contains("content-filter-item-checkbox")&&this.#we()}#Le(e){if("Enter"!==e.code&&"Space"!==e.code||this.#ve.toggleSelectedState(),"ArrowRight"===e.code){if(!this.#ve.isExpandable())return;this.#ve.isExpanded()?this.#ke(this.#Ie()):this.#v(e)}else if("ArrowLeft"===e.code)this.#ve.isExpandable()&&this.#ve.isExpanded()?this.#v(e):this.#ke(this.#Se());else if("ArrowDown"===e.key)this.#ke(this.#Ie());else if("ArrowUp"===e.key)this.#ke(this.#Ce());else if("Home"===e.key)this.#ke(this.#Ae()[0]);else if("End"===e.key)this.#ke(this.#Ae().slice(-1)[0]);else if("*"===e.key){if(!this.#ve.isExpandable())return;[...this.#ve,...this.#Te(this.#ve)].filter((e=>e.isExpandable())).forEach((e=>{e.toggleExpandedState(!0)})),this.#Ee()}else if(1===e.key.length&&e.key.match(/\S/)&&!e.ctrlKey&&!e.metaKey){const t=this.#Ae().indexOf(this.#ve),s=this.#Ae().slice(t+1).find((t=>t.getLabel().toLowerCase().startsWith(e.key.toLowerCase())));s&&this.#ke(s)}}#we(){const e=this.#ue.filter((e=>e.isSelected()));let t;0===e.length?(t=this.#fe.showNone,this.#be.classList.remove("display-none")):e.length===this.#ue.length?(t=this.#fe.showAll,this.#be.classList.add("display-none")):(t=this.#fe.showSelected,this.#be.classList.remove("display-none")),this.#ge.innerHTML=t,this.#r.onFilterChange(e.map((e=>e.getSubcontentId())))}#ye(){this.#ue.forEach((e=>{e.toggleSelectedState(!0)})),this.#we()}#ke(e){e&&(this.#ve.toggleTabbable(!1),this.#ve=e,this.#ve.toggleTabbable(!0),this.#ve.focus())}#Te(e){if(!e||!e.isVisible())return[];const t=this.#Ae(),s=t.indexOf(e),a=e.getLevel(),i=e=>{const t=[];for(const s of e){const e=s.getLevel();if(e===a)t.push(s);else if(e<a)break}return t};return[...i(t.slice(0,s).reverse()),...i(t.slice(s+1))]}#Ae(){return this.#ue.filter((e=>e.isVisible()))}#Se(){const e=this.#Ae();for(let t=e.indexOf(this.#ve)-1;t>=0;t--)if(e[t].isExpandable())return e[t];return null}#Ce(){const e=this.#Ae(),t=e.indexOf(this.#ve);return-1===t||0===t?null:e[t-1]}#Ie(){const e=this.#Ae(),t=e.indexOf(this.#ve);return-1===t||t===e.length-1?null:e[t+1]}#Ee(){this.#Ae().forEach(((e,t,s)=>{e.toggleBorder("top",0===t||e.getLevel()<s[t-1].getLevel()),e.toggleBorder("bottom",t!==s.length-1&&e.getLevel()<=s[t+1].getLevel()),e.toggleBorder("left",0!==t)}))}}const y="locale",x={orDragTheFileHere:"or drag the file here",removeFile:"Remove file",selectYourLanguage:"Select your language",uploadProgress:"Upload progress",uploadYourH5Pfile:"Upload your H5P file",yourFileIsBeingChecked:"Your file is being checked",yourFileWasCheckedSuccessfully:"Your file check was completed",totalMessages:"Total messages",issues:"issues",results:"results",filterBy:"Filter by",groupBy:"Group by",download:"Download",allFilteredOut:"All messages have been filtered out by content.",reportTitleTemplate:"H5P Caretaker report for @title",contentFilter:"Content filter",showAll:"Show all",showSelected:"Various selected contents",showNone:"Show none",filterByContent:"Filter by content:",reset:"Reset",showDetails:"Show details",hideDetails:"Hide details",unknownError:"Something went wrong, but I dunno what, sorry!",checkServerLog:"Please check the server log.",expandList:"Expand list",collapseList:"Collapse list",changeSortingGrouping:"Change sorting/grouping",nextMessage:"Next message",previousMessage:"Previous message"},L=200,E=300;window.H5PCaretaker=class{#d;#$e;#se;#Me;#De;#Oe;#fe;#r={};constructor(e={},t={}){if(this.#fe={...x,...window.H5P_CARETAKER_L10N,...e.l10n},this.#Me=e.endpoint,this.#De=e.sessionKeyName,this.#Oe=e.sessionKeyValue,!this.#Me){const e=document.querySelector(".h5p-caretaker");this.#Me=e?.dataset.uploadEndpoint??"./upload"}this.#r=t,this.#r.onInitialized=this.#r.onInitialized??(()=>{}),this.#r.onUploadStarted=this.#r.onUploadStarted??(()=>{}),this.#r.onUploadEnded=this.#r.onUploadEnded??(()=>{}),this.#r.onReset=this.#r.onReset??(()=>{}),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",(()=>{this.#Pe()})):this.#Pe()}#Pe(){const e=document.querySelector(".h5p-caretaker .select-language");e?.setAttribute("aria-label",x.selectYourLanguage),e?.addEventListener("change",(e=>{this.#ze(e)})),this.#d=new a({selectorDropzone:".h5p-caretaker .dropzone",...this.#De&&{sessionKeyName:this.#De},...this.#Oe&&{sessionKeyValue:this.#Oe},l10n:{orDragTheFileHere:this.#fe.orDragTheFileHere,removeFile:this.#fe.removeFile,uploadProgress:this.#fe.uploadProgress,uploadYourH5Pfile:this.#fe.uploadYourH5Pfile}},{upload:async e=>{this.#S(e)},reset:()=>{this.#ye()}}),window.setTimeout((()=>{this.#r.onInitialized()}),0)}async uploadByURL(e){if(this.#ye(),"string"==typeof e){e=encodeURI(e);try{const t=await fetch(e),s=await t.arrayBuffer(),a=new Uint8Array(s),i=e.split("/").pop(),n=new File([a],i,{type:"application/zip"}),l=new DataTransfer;l.items.add(n),this.#d.upload(l.files)}catch(e){this.#r.onUploadEnded(!1)}}else this.#r.onUploadEnded(!1)}#S(e={}){this.#r.onUploadStarted();const t=new FormData;t.append("file",e.file),e.session?.key&&e.session?.value&&t.append(e.session.key,e.session.value),t.append("sessionKeyName",this.#De),t.set("locale",document.querySelector(".select-language")?.value??"en"),this.#d.setStatus(""),this.#d.showProgress();const s=new XMLHttpRequest;if(s.open("POST",this.#Me,!0),s.upload.addEventListener("progress",(e=>{e.lengthComputable&&this.#Ve(e.loaded/e.total*100)})),s.addEventListener("load",(()=>{this.#Be(s),this.#r.onUploadEnded(!0)})),s.addEventListener("error",(()=>{this.#Re(s.statusText)})),e.signal&&(e.signal.addEventListener("abort",(()=>{s.abort(),this.#r.onUploadEnded(!1)})),e.signal.aborted))return s.abort(),void this.#r.onUploadEnded(!1);s.send(t)}#ye(){const e=new URLSearchParams(window.location.search);for(const t of e.keys())t!==y&&e.delete(t);window.history.replaceState({},document.title,`${window.location.pathname}?${e.toString()}${window.location.hash}`),document.querySelector(".filter-tree").innerHTML="",document.querySelector(".output").innerHTML="",this.#r.onReset()}#ze(e){const t=new URLSearchParams(window.location.search);t.set(e.target.dataset.localeKey??y,e.target.value),window.location.href=`${window.location.pathname}?${t.toString()}${window.location.hash}`}#Ve(e){this.#d.setProgress(e),100===e&&(this.#d.hideProgress(),this.#d.setStatus(this.#fe.yourFileIsBeingChecked,"pulse"))}#Be(e){this.#d.hideProgress();const t=e.status>=L&&e.status<E;let s,a;if([s,a]=this.parseResponse(e),!t||a)return void this.#Re(a);this.#fe={...this.#fe,...s.client.translations},this.#d.setStatus(this.#fe.yourFileWasCheckedSuccessfully);const i=e=>{const t={label:e.label,subcontentId:e.subContentId};return Array.isArray(e.children)&&(t.items=e.children.map((e=>i(e)))),t},n=new v({item:i(s.contentTree),l10n:{contentFilter:this.#fe.contentFilter,showAll:this.#fe.showAll,showSelected:this.#fe.showSelected,showNone:this.#fe.showNone,filterByContent:this.#fe.filterByContent,reset:this.#fe.reset,expandList:this.#fe.expandList,collapseList:this.#fe.collapseList}},{onFilterChange:e=>{const t=this.#Fe(s.messages.filter((t=>e.includes(t.subContentId))));this.#$e.update(t),this.#se.filter(e)}});document.querySelector(".filter-tree").append(n.getDOM()),s.messages=s.messages.map((e=>{e.issues=("error"===e.level||"caution"===e.level)&&"issues";const t=e.details?.path;return t&&t.startsWith("images/")?(e.details?.path&&e.details?.path.startsWith("images/")&&(e.details.base64=s.raw.media.images[t.split("/").pop()]?.base64),e):e})),this.#$e=new r({results:this.#Fe(s.messages),l10n:{results:this.#fe.results,filterBy:this.#fe.filterBy,groupBy:this.#fe.groupBy,download:this.#fe.download,changeSortingGrouping:this.#fe.changeSortingGrouping}},{onResultsTypeChanged:e=>{this.#se.show(e)},onDownload:()=>{const e=this.#fe.reportTitleTemplate.replace("@title",`${s.raw.h5pJson.title} (${s.raw.h5pJson.mainLibrary})`);new b({title:e,messages:s.messages,l10n:this.#fe,translations:s.client.translations}).download()}}),document.querySelector(".output").append(this.#$e.getDOM());const l=[...new Set(s.messages.map((e=>e.category)))];this.#se=new g({sets:{level:["error","caution","info"],category:l,issues:[{id:"issues",header:this.#fe.issues}]},messages:s.messages,translations:s.client.translations,l10n:{allFilteredOut:this.#fe.allFilteredOut,nextMessage:this.#fe.nextMessage,previousMessage:this.#fe.previousMessage,showDetails:this.#fe.showDetails,hideDetails:this.#fe.hideDetails}}),document.querySelector(".output").append(this.#se.getDOM())}parseResponse(e){let t,s=null;try{t=JSON.parse(e.responseText)}catch(a){t=!1,s=this.#Ne(e.responseText)}return t.error&&(s=t.error),[t,s]}#Ne(e){return!e||((e="")=>/<\/?[^>]+(>|$)/.test(e))(e)?`${this.#fe.unknownError} ${this.#fe.checkServerLog}`:e}#Fe(e){const s=[{id:"error",value:e.filter((e=>"error"===e.level)).length,max:e.length,label:t(this.#fe.error),link:"#error",color:"var(--color-error)",percentage:!1},{id:"caution",value:e.filter((e=>"caution"===e.level)).length,max:e.length,label:t(this.#fe.caution),link:"#caution",color:"var(--color-caution)",percentage:!1},{id:"info",value:e.filter((e=>"info"===e.level)).length,max:e.length,label:t(this.#fe.info),link:"#info",color:"var(--color-info)",percentage:!1}],a=[...new Set(e.map((e=>e.category)))].map((s=>({id:s,value:e.filter((e=>e.category===s)).length,max:e.length,label:t(this.#fe[s]),link:`#${s}`,color:"var(--color-primary)",percentage:!1})));return{level:{label:this.#fe.level,header:this.#fe.totalMessages,value:e.length,items:s,type:"group"},category:{label:this.#fe.category,header:this.#fe.totalMessages,value:e.length,items:a,type:"group"}}}#Re(e){this.#d.setStatus(e,"error"),this.#r.onUploadEnded(!1)}}})();